<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="2d shooter game online. Build own barricades, destroy enemy">
    <meta name="keywords" content="2d,shooter,play,online,socket,io">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="icon" type="image/png" id="icoico" href="/g/cannons/img/favicon.png">
    <title>2d shooter game online, build own fortress, destroy enemy</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161435685-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-161435685-1');
    </script>
    <!-- end Global site tag (gtag.js) - Google Analytics -->

  </head>
  <body oncontextmenu="return false;">
    <canvas id="canvas"></canvas>

    <!-- recaptcha -->
    <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  	<script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      var ww = 1920;
      var hh = 1080;
      var mouse = {};
      // $(document).on("mousemove", function(e) {
      //   mouse.x = e.pageX;
      //   mouse.y = e.pageY;
      // });
      var socket = io();

      var allTextures = {
        cannonIco: "cannonIco.png",
        chooseObjects: "chooseObjects.png",
        exitAccount: "exitAccount.png",
        explode1: "explode1.png",
        explode2: "explode2.png",
        explode3: "explode3.png",
        favicon: "favicon.png",
        icoInventar: "icoInventar.png",
        icoStats: "icoStats.png",
        imready: "imready.png",
        leftClick: "leftClick.png",
        leftSummerGrass: "leftSummerGrass.png",
        rightClick: "rightClick.png",
        rightSummerGrass: "rightSummerGrass.png",
        sky: "sky.png",
        wallIco: "wallIco.png",
        water: "water.png",
        itemcannon1: "cannon1.png",
        itemcannon2: "cannon2.png",
        itemwall: "wall.png"
      }

      var idDesigner = getCookie("idDesigner");
      if (!idDesigner || idDesigner != "") {
        for (i in allTextures) {
          //exits designer img
          var testUrl = "/img/designers/"+idDesigner+"~~"+allTextures[i];
          var http = new XMLHttpRequest();
          http.open('HEAD', testUrl, false);
          http.send();
          if (new URL(http.responseURL).pathname == testUrl) {
            allTextures[i] = "img/designers/"+idDesigner+"~~"+allTextures[i];
          } else {
            allTextures[i] = "/g/cannons/img/"+allTextures[i];
          }
        }

        $("#icoico").attr("href", allTextures.favicon);
      }

      //var backgroundUrl = "../img/sky.png";
      //var backgroundUrl = "../"+allTextures.sky;

      var imgtest = new Image();//thisplace
      imgtest.src = allTextures.explode1;
      var imgExplode1 = imgtest;
      imgtest = new Image();
      imgtest.src = allTextures.explode2;
      var imgExplode2 = imgtest;
      imgtest = new Image();
      imgtest.src = allTextures.explode3;
      var imgExplode3 = imgtest;
      var imgobjcannonIco = new Image();
      imgobjcannonIco.src = allTextures.cannonIco;
      var imgobjchooseObjects = new Image();
      imgobjchooseObjects.src = allTextures.chooseObjects;
      var imgobjimready = new Image();
      imgobjimready.src = allTextures.imready;
      var imgobjleftClick = new Image();
      imgobjleftClick.src = allTextures.leftClick;
      var imgobjleftSummerGrass = new Image();
      imgobjleftSummerGrass.src = allTextures.leftSummerGrass;
      var imgobjrightClick = new Image();
      imgobjrightClick.src = allTextures.rightClick;
      var imgobjrightSummerGrass = new Image();
      imgobjrightSummerGrass.src = allTextures.rightSummerGrass;
      var imgobjwallIco = new Image();
      imgobjwallIco.src = allTextures.wallIco;
      var imgobjwater = new Image();
      imgobjwater.src = allTextures.water;
      var imgobjitemcannon1 = new Image();
      imgobjitemcannon1.src = allTextures.itemcannon1;// "cannon1.png"
      var imgobjitemcannon2 = new Image();
      imgobjitemcannon2.src = allTextures.itemcannon2;// "cannon2.png"
      var imgobjitemwall = new Image();
      imgobjitemwall.src = allTextures.itemwall;// "wall.png

      $("#canvas").css("background-image", "url('/g/cannons/img/sky.png')");

      //tick tock
      setInterval(function() {
        if (gui) {
          if ((gui.timer.val <= 0 && me.status == 3 && me.side == 1) || (gui.timer.val <= 0 && me.status == 3 && me.side == 2) || (gui.timer.val <= 0 && me.status == 3 && enemy.bot)) {
            //startgame
            if (enemy.bot) {
              startGameBot();
            } else {
              socket.emit('startGame', idRoom);
            }
          }
          if (gui.timer.val <= 0 && me.status == 4 && me.turn) {
            if (enemy.bot) {
              changeTurnBot();
            } else {
              //if (me.side == 1) {
                socket.emit('changeTurn', idRoom);
              //}
            }
            //false vectorShoot
            gui.vectorShoot.visible = false;
            flags.chooseCannon = false;
            gui.circleShoot.visible = false;

            gui.vectorShoot.coor1.x = 0;
            gui.vectorShoot.coor1.y = 0;
            gui.vectorShoot.coor2.x = 0;
            gui.vectorShoot.coor2.y = 0;

            $("body").css("cursor", "default");
            //end false vectorShoot
          }
          if (!gui.timer.pause) {
            gui.timer.val--;
          }
        }
      }, 1000);

      function closeCA(addCookie) {
        $("#wrapCookieAcceptance").hide();
        if (addCookie) {
          setCookie("cookieAcceptance", 1, 30);
        }
      }
      var cookieAcceptance = getCookie("cookieAcceptance");
      if (cookieAcceptance && cookieAcceptance == "1") {
        setTimeout(function() {
          closeCA(false)
        }, 100);
      }

      function onToGuiAim(mouse) {
        if (gui.aim.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;
          if (me.side == 1 && x > gui.aim.coordinate.x && x < gui.aim.coordinate.x+gui.aim.r && y > gui.aim.coordinate.y-gui.aim.r && y < gui.aim.coordinate.y) {
            if (Math.sqrt(Math.pow(x-gui.aim.coordinate.x, 2)+Math.pow(y-gui.aim.coordinate.y, 2)) <= gui.aim.r) {
              return true;
            }
          } else if (me.side == 2 && x > ww-gui.aim.coordinate.x-gui.aim.r && x < ww-gui.aim.coordinate.x && y > gui.aim.coordinate.y-gui.aim.r && y < gui.aim.coordinate.y) {
            if (Math.sqrt(Math.pow(x-(ww-gui.aim.coordinate.x), 2)+Math.pow(y-gui.aim.coordinate.y, 2)) <= gui.aim.r) {
              return true;
            }
          }
        }
        return false;
      }


      function onToGuiButtonShot(mouse) {
        if (gui.buttonShot.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;
          if (me.side == 1 && x > gui.buttonShot.coordinate.x && x < gui.buttonShot.coordinate.x+gui.buttonShot.size.w && y > gui.buttonShot.coordinate.y && y < gui.buttonShot.coordinate.y+gui.buttonShot.size.h) {
              return true;
          } else if (me.side == 2 && x > ww-gui.buttonShot.coordinate.x-gui.buttonShot.size.w && x < ww-gui.buttonShot.coordinate.x && y > gui.buttonShot.coordinate.y && y < gui.buttonShot.coordinate.y+gui.buttonShot.size.h) {
              return true;
          }
        }
        return false;
      }

      function onToGuiInvertarBuilt(mouse) {
        if (gui.inventarBuilt.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;
          var length = gui.inventarBuilt.contain.length;

          if (x > gui.inventarBuilt.coordinate.x && x < gui.inventarBuilt.coordinate.x+length*(gui.inventarBuilt.margin+gui.inventarBuilt.sizeIco.w) && y > gui.inventarBuilt.coordinate.y+gui.inventarBuilt.margin && y < gui.inventarBuilt.coordinate.y+gui.inventarBuilt.margin+gui.inventarBuilt.sizeIco.h) {
            for (var i = 0; i < length; i++) {
              if (x > gui.inventarBuilt.coordinate.x+i*(gui.inventarBuilt.margin+gui.inventarBuilt.sizeIco.w) && x < gui.inventarBuilt.coordinate.x+(i+1)*(gui.inventarBuilt.margin+gui.inventarBuilt.sizeIco.w)-gui.inventarBuilt.margin) {
                return gui.inventarBuilt.contain[i].name;
              }
            }
          }
        }
        return false;
      }

      function onToGuiBuiltPlace(mouse) {
        //if (gui.inventarBuilt.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;

          var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
          var addBuild = 0;
          if (isphone) {
            addBuild = -0.2*hh;
          }

          if (me.side == 1) {
            if (x > 0 && x < 0.4*ww && y > 0.25*hh+addBuild && y < 0.85*hh) {
              return true;
            }
          } else if (me.side == 2) {
            if (x > 0.6*ww && x < ww && y > 0.25*hh+addBuild && y < 0.85*hh) {
              return true;
            }
          }
        //}
        return false;
      }

      function onToCannon() {
        var x = (mouse.x/$(window).width())*ww;
        var y = (mouse.y/$(window).height())*hh;
        for (var i = 0; i < obj.length; i++) {
          if (obj[i].tag == "cannon") {
            if (x > obj[i].coordinate.x-obj[i].size.w/2 && x < obj[i].coordinate.x+obj[i].size.w/2) {
              if (y > obj[i].coordinate.y-obj[i].size.h/2 && y < obj[i].coordinate.y+obj[i].size.h/2) {
                return obj[i]
              }
            }
          }
        }
        return false
      }

      function pointIntoFloor(point) {
        for (i in obj) {
          if (obj[i].tag == "floor") {
            if (point.x >= obj[i].coordinate.x-obj[i].size.w/2 && point.x <= obj[i].coordinate.x+obj[i].size.w/2) {
              if (point.y >= obj[i].coordinate.y-obj[i].size.h/2 && point.y <= obj[i].coordinate.y+obj[i].size.h/2) {
                return obj[i];
              }
            }
          }
        }
        return false;
      }

      function pointIntoCannon(point) {
        for (i in obj) {
          if (obj[i].tag == "cannon") {
            if (point.x >= obj[i].coordinate.x-obj[i].size.w/2 && point.x <= obj[i].coordinate.x+obj[i].size.w/2) {
              if (point.y >= obj[i].coordinate.y-obj[i].size.h/2 && point.y <= obj[i].coordinate.y+obj[i].size.h/2) {
                return obj[i];
              }
            }
          }
        }
        return false;
      }

      function wallIsCorrect(wall) {
        //if (gui.inventarBuilt.visible) {
          // var x = (mouse.x/$(window).width())*ww;
          // var y = (mouse.y/$(window).height())*hh;

          var x = wall.coordinate.x;
          var y = wall.coordinate.y;

          //check on support bottom
          var objSupport1 = pointIntoFloor({x: wall.coordinate.x, y: wall.coordinate.y+wall.size.h/2+10});
          if (objSupport1) {
            wall.coordinate.y += (Math.abs(wall.coordinate.y-objSupport1.coordinate.y)-wall.size.h/2-objSupport1.size.h/2);
            if (Math.abs(objSupport1.coordinate.x-wall.coordinate.x) <= 10) {
              wall.coordinate.x = objSupport1.coordinate.x;
            }
          }

          //check on support left
          var objSupport2 = pointIntoFloor({x: wall.coordinate.x-wall.size.w/2-10, y: wall.coordinate.y});
          if (objSupport2) {
            wall.coordinate.x -= (Math.abs(wall.coordinate.x-objSupport2.coordinate.x)-wall.size.w/2-objSupport2.size.w/2);
            if (Math.abs(objSupport2.coordinate.y-wall.coordinate.y) <= 10) {
              wall.coordinate.y = objSupport2.coordinate.y;
            }
          }

          //check on support right
          var objSupport3 = pointIntoFloor({x: wall.coordinate.x+wall.size.w/2+10, y: wall.coordinate.y});
          if (objSupport3) {
            wall.coordinate.x += (Math.abs(wall.coordinate.x-objSupport3.coordinate.x)-wall.size.w/2-objSupport3.size.w/2);
            if (Math.abs(objSupport3.coordinate.y-wall.coordinate.y) <= 10) {
              wall.coordinate.y = objSupport3.coordinate.y;
            }
          }

          //check on support top
          var objSupport4 = pointIntoFloor({x: wall.coordinate.x, y: wall.coordinate.y-wall.size.h/2-10});
          if (objSupport4) {
            wall.coordinate.y -= (Math.abs(wall.coordinate.y-objSupport4.coordinate.y)-wall.size.h/2-objSupport4.size.h/2);
            if (Math.abs(objSupport4.coordinate.x-wall.coordinate.x) <= 10) {
              wall.coordinate.x = objSupport4.coordinate.x;
            }
          }

          if (!objSupport1 && !objSupport2 && !objSupport3 && !objSupport4) {
            wall.temporary = 1;
            wall.color = "#cc000077";
            //wall.url = "img/wallBan.png";
            return wall
          }

          //check on the other floors
          for (i in obj) {
            if (obj[i].tag == "floor" || obj[i].tag == "cannon") {
              if (wall.coordinate.x+wall.size.w/2 > obj[i].coordinate.x-obj[i].size.w/2 && wall.coordinate.x-wall.size.w/2 < obj[i].coordinate.x+obj[i].size.w/2) {
                if (wall.coordinate.y+wall.size.h/2 > obj[i].coordinate.y-obj[i].size.h/2 && wall.coordinate.y-wall.size.h/2 < obj[i].coordinate.y+obj[i].size.h/2) {
                  wall.temporary = 1;
                  wall.color = "#cc000077";
                  //wall.url = "img/wallBan.png";
                  return wall
                }
              }
            }
          }

          wall.temporary = 2;
          wall.color = "#33333377";
          //wall.url = "img/wallTemporary.png";
          return wall

        //}
      }

      function cannonIsCorrect(cannon) {
        //if (gui.inventarBuilt.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;

          //check other floors
          for (i in obj) {
            if (obj[i].tag == "floor" || obj[i].tag == "cannon") {
              if (Math.abs((cannon.coordinate.y+cannon.size.h/2)-(obj[i].coordinate.y-obj[i].size.h/2)) <= 50 && obj[i].tag == "floor") {
                cannon.coordinate.y -= (cannon.coordinate.y+cannon.size.h/2)-(obj[i].coordinate.y-obj[i].size.h/2);
              }
              if (cannon.coordinate.x+cannon.size.w/2 > obj[i].coordinate.x-obj[i].size.w/2 && cannon.coordinate.x-cannon.size.w/2 < obj[i].coordinate.x+obj[i].size.w/2) {
                if (cannon.coordinate.y+cannon.size.h/2 > obj[i].coordinate.y-obj[i].size.h/2 && cannon.coordinate.y-cannon.size.h/2 < obj[i].coordinate.y+obj[i].size.h/2) {
                  return false
                }
              }
            }
          }

          //check on support bottom
          var objSupport = pointIntoFloor({x: cannon.coordinate.x, y: cannon.coordinate.y+cannon.size.h/2+10});

          if (objSupport) {
            return objSupport
          }

          return false
        //}
      }

      function cannonIsCorrect1(cannon) {
        //if (gui.inventarBuilt.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;

          //check on support bottom
          var objSupport = pointIntoFloor({x: cannon.coordinate.x, y: cannon.coordinate.y+cannon.size.h/2+10});

          if (objSupport) {
            return true
          }

          return false
        //}
      }

      function wallIsCorrectTF(wall, from) {
        //if (gui.inventarBuilt.visible) {
          // var x = (mouse.x/$(window).width())*ww;
          // var y = (mouse.y/$(window).height())*hh;

          var x = wall.coordinate.x;
          var y = wall.coordinate.x;

          //check on support bottom
          var objSupport1 = pointIntoFloor({x: wall.coordinate.x, y: wall.coordinate.y+wall.size.h/2+10});
          //check on support left
          var objSupport2 = pointIntoFloor({x: wall.coordinate.x-wall.size.w/2-10, y: wall.coordinate.y});
          //check on support right
          var objSupport3 = pointIntoFloor({x: wall.coordinate.x+wall.size.w/2+10, y: wall.coordinate.y});
          //check on support top
          var objSupport4 = pointIntoFloor({x: wall.coordinate.x, y: wall.coordinate.y-wall.size.h/2-10});

          if (objSupport1 || objSupport2 || objSupport3 || objSupport4) {
            if (objSupport1.temporary == "always") {
              return true
            } else if (objSupport1 && objSupport1.temporary == 3) {
              var flag = false;
              if (from) {
                for (i in from) {
                  if (from[i] == objSupport1) {
                    flag = true;
                    break;
                  }
                }
              }

              if (!flag) {
                var froms = [];
                if (from) {
                  froms = from;
                }
                froms.push(wall);
                if (wallIsCorrectTF(objSupport1, froms)) {
                  return true;
                }
              }
            }

            if (objSupport2.temporary == "always") {
              return true
            } else if (objSupport2 && objSupport2.temporary == 3) {
              var flag = false;
              if (from) {
                for (i in from) {
                  if (from[i] == objSupport2) {
                    flag = true;
                    break;
                  }
                }
              }

              if (!flag) {
                var froms = [];
                if (from) {
                  froms = from;
                }
                froms.push(wall);
                if (wallIsCorrectTF(objSupport2, froms)) {
                  return true;
                }
              }
            }

            if (objSupport3.temporary == "always") {
              return true
            } else if (objSupport3 && objSupport3.temporary == 3) {
              var flag = false;
              if (from) {
                for (i in from) {
                  if (from[i] == objSupport3) {
                    flag = true;
                    break;
                  }
                }
              }

              if (!flag) {
                var froms = [];
                if (from) {
                  froms = from;
                }
                froms.push(wall);
                if (wallIsCorrectTF(objSupport3, froms)) {
                  return true;
                }
              }
            }

            if (objSupport4.temporary == "always") {
              return true
            } else if (objSupport4 && objSupport4.temporary == 3) {
              var flag = false;
              if (from) {
                for (i in from) {
                  if (from[i] == objSupport4) {
                    flag = true;
                    break;
                  }
                }
              }

              if (!flag) {
                var froms = [];
                if (from) {
                  froms = from;
                }
                froms.push(wall);
                if (wallIsCorrectTF(objSupport4, froms)) {
                  return true;
                }
              }
            }
          }

          return false

        //}
      }

      function onToGuiReady() {
        if (gui.buttonReady.visible) {
          var x = (mouse.x/$(window).width())*ww;
          var y = (mouse.y/$(window).height())*hh;
          if (x > gui.buttonReady.coordinate.x-gui.buttonReady.size.w/2 && x < gui.buttonReady.coordinate.x+gui.buttonReady.size.w/2) {
            if (y > gui.buttonReady.coordinate.y-gui.buttonReady.size.h/2 && y < gui.buttonReady.coordinate.y+gui.buttonReady.size.h/2) {
              return true
            }
          }
        }
        return false
      }

      function delWallUnderMouse() {
        var x = (mouse.x/$(window).width())*ww;
        var y = (mouse.y/$(window).height())*hh;
        var wallDel = pointIntoFloor({x: x, y: y});
        if (wallDel) {
          obj.splice(obj.indexOf(wallDel), 1);
          addCounter("stoneWall", 1);
          for (var i = 0; i < obj.length; i++) {
            if (obj[i].temporary == 3 && obj[i].tag == "floor") {
              if (!wallIsCorrectTF(obj[i])) {
                obj.splice(i, 1);
                addCounter("stoneWall", 1);
                i--;
              }
            }
          }
          for (var i = 0; i < obj.length; i++) {
            if (obj[i].temporary == 3 && obj[i].tag == "cannon") {
              if (!cannonIsCorrect1(obj[i])) {
                obj.splice(i, 1);
                addCounter("cannon", 1);
                i--;
              }
            }
          }
        }
        var cannonDel = pointIntoCannon({x: x, y: y});
        if (cannonDel) {
          obj.splice(obj.indexOf(cannonDel), 1);
          addCounter("cannon", 1);
        }
      }

      function getAverage(array) {
        var summ = 0;
        for (var i = 0; i < array.length; i++) {
          summ += array[i];
        }
        return summ/array.length
      }

      function getCounter(name) {
        for (i in gui.inventarBuilt.contain) {
          if (gui.inventarBuilt.contain[i].name == name) {
            return gui.inventarBuilt.contain[i].counter;
          }
        }
      }

      function addCounter(name, num) {
        for (i in gui.inventarBuilt.contain) {
          if (gui.inventarBuilt.contain[i].name == name) {
            gui.inventarBuilt.contain[i].counter += num;
            break;
          }
        }
      }

      function paintChoose(choosen) {
        for (var i = 0; i < obj.length; i++) {
          if (obj[i].tag == "cannon") {
            if (choosen && choosen.coordinate.x == obj[i].coordinate.x && choosen.coordinate.y == obj[i].coordinate.y) {
              obj[i].color = "#c400c7";
              obj[i].choosen = true;
              gui.labelChooseCannon.visible = false;
            } else {
              obj[i].color = "#4c52c7";
              obj[i].choosen = false;
            }
          }
        }
      }

      function refreshActiveIntervalBuild(item) {
        for (var i = 0; i < gui.inventarBuilt.contain.length; i++) {
          if (gui.inventarBuilt.contain[i].name == item) {
            gui.inventarBuilt.contain[i].active = true;
          } else {
            gui.inventarBuilt.contain[i].active = false;
          }
        }
      }

      function radToDeg(rad) {
        return rad*(180/Math.PI);
      }

      var pointShoot = {x: 0, y:0};
      function chooseCannon(cannon) {

        paintChoose(cannon);

        gui.aim.visible = true;
        gui.buttonShot.visible = true;

        // if (me.side == 1) {
        //   pointShoot.x = cannon.coordinate.x+cannon.size.w;
        // } else if (me.side == 2) {
        //   pointShoot.x = cannon.coordinate.x-cannon.size.w;
        // }
        // pointShoot.y = cannon.coordinate.y-cannon.size.h;
        pointShoot.x = cannon.coordinate.x;
        pointShoot.y = cannon.coordinate.y;

      }

      function trueCannonAim(cannon) {

        gui.labelChooseCannon.visible = false;
        offAreaBuild();

        gui.vectorShoot.visible = true;
        flags.chooseCannon = cannon;

        pointShoot.x = cannon.coordinate.x;
        pointShoot.y = cannon.coordinate.y;

        $("body").css("cursor", "none");
      }
      function moveCannonAim() {
        var x = (mouse.x/$(window).width())*ww;
        var y = (mouse.y/$(window).height())*hh;
        var cannon = flags.chooseCannon;

        gui.vectorShoot.coor1.x = cannon.coordinate.x;
        gui.vectorShoot.coor1.y = cannon.coordinate.y;
        gui.vectorShoot.coor2.x = x;
        gui.vectorShoot.coor2.y = y;

        var length = Math.sqrt(Math.pow(gui.vectorShoot.coor1.x-gui.vectorShoot.coor2.x, 2)+Math.pow(gui.vectorShoot.coor1.y-gui.vectorShoot.coor2.y, 2));
        if (length < 100 || gui.vectorShoot.coor2.y-gui.vectorShoot.coor1.y > 0) {
          gui.vectorShoot.visible = false;
          gui.circleShoot.visible = false;
        } else {
          if ((me.side == 1 && gui.vectorShoot.coor2.x-gui.vectorShoot.coor1.x > 0) || (me.side == 2 && gui.vectorShoot.coor2.x-gui.vectorShoot.coor1.x < 0)) {
            gui.vectorShoot.visible = true;

            //move visible circleshoot
            gui.circleShoot.visible = true;
            if (me.side == 1) {
              gui.circleShoot.coordinate.x = cannon.coordinate.x+gui.circleShoot.radius*gui.circleShoot.scale.x;
              gui.circleShoot.speedAnimation = 0.01;
            } else if (me.side == 2) {
              gui.circleShoot.coordinate.x = cannon.coordinate.x-gui.circleShoot.radius*gui.circleShoot.scale.x;
              gui.circleShoot.speedAnimation = -0.01;
            }
            gui.circleShoot.coordinate.y = cannon.coordinate.y;
            gui.circleShoot.scale.x = Math.abs(x-cannon.coordinate.x)*0.03;//0.03
            gui.circleShoot.scale.y = Math.abs(y-cannon.coordinate.y)*0.017;//0.17
            //end move visible circleshoot

            //move barrel cannon
            var angle = Math.acos(Math.abs(x-cannon.coordinate.x)/length);
            cannon.angle = -angle;
            //end move barrel cannon

          } else {
            gui.vectorShoot.visible = false;
            gui.circleShoot.visible = false;
          }
        }
      }
      function falseCannonAim() {
        if (gui.vectorShoot.visible) {
          shootVector({x: gui.vectorShoot.coor1.x, y: gui.vectorShoot.coor1.y}, {x:gui.vectorShoot.coor2.x-gui.vectorShoot.coor1.x, y:gui.vectorShoot.coor2.y-gui.vectorShoot.coor1.y});
        }
        socket.emit('changeAngle', flags.chooseCannon, me.side, idRoom);
        gui.vectorShoot.visible = false;
        flags.chooseCannon = false;
        gui.circleShoot.visible = false;

        gui.vectorShoot.coor1.x = 0;
        gui.vectorShoot.coor1.y = 0;
        gui.vectorShoot.coor2.x = 0;
        gui.vectorShoot.coor2.y = 0;

        $("body").css("cursor", "default");
      }

      function shootVector(from, speed) {
        var sign = 1;
        if (me.side == 2) {
          sign = -1;
        }
        var maxSpeedBullet = 280;
        speed.r = Math.sqrt(Math.pow(speed.x, 2)+Math.pow(speed.y, 2));
        speed.angle = Math.atan(speed.y/speed.x);
        if (speed.r > maxSpeedBullet) {
          speed.r = maxSpeedBullet;
        }
        speed.x = sign*speed.r*Math.cos(speed.angle);
        speed.y = sign*speed.r*Math.sin(speed.angle);

        var muffler = 0.1;
        var bullet = {
            tag: "bullet",
            coordinate: {
              x: from.x,
              y: from.y
            },
            speed: {
              x: speed.x*muffler,
              y: speed.y*muffler
            },
            r: 7,
            color: "#000"
        };

        if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
          finishData.forcesShooting.p1.push(Math.round(speed.r*100)/100);
        } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
          finishData.forcesShooting.p2.push(Math.round(speed.r*100)/100);
        }

        if (me.side == 1 && me.turn) {
          finishData.shoots.p1++;
        } else if (me.side == 2 && me.turn) {
          finishData.shoots.p2++;
        } else if (me.side == 1 && enemy.turn) {
          finishData.shoots.p2++;
        } else if (me.side == 2 && enemy.turn) {
          finishData.shoots.p1++;
        }

        if (enemy.bot) {
          obj.push(bullet);
          changeTurnBot();
        } else {
          socket.emit('shoot', bullet, me.side, idRoom);
          obj.push(bullet);
          socket.emit('changeTurn', idRoom);
        }
      }

      var flags = {
        guiAim: false,
        guiShot: false,
        placeBuilt: false,
        chooseCannon: false
      };
      $(document).on("keydown", function(e) {
        if (e.ctrlKey && e.keyCode == 191){
          socket.emit('getOnline');
        }
      });

      socket.on('sendAlert', function(text) {
        console.log(text);
  		});

      $(document).on("mousedown", function(e) {
        mouse.x = e.pageX;
        mouse.y = e.pageY;
        //socket.emit('alert', idRoom, e);
        whenmousedown(e);
      });
      $(document).on("mouseup", function(e) {
        mouse.x = e.pageX;
        mouse.y = e.pageY;
        //socket.emit('alert', idRoom, e);
        whenmouseup(e);
      });
      $(document).on("mousemove", function(e) {
        mouse.x = e.pageX;
        mouse.y = e.pageY;
        //socket.emit('alert', idRoom, e);
        whenmousemove(e);
      });
      $(document).on("touchstart", function(e) {
        mouse.x = e.touches[0].clientX;
        mouse.y = e.touches[0].clientY;
        //console.log(e.touches[0].clientX+" || "+e.touches[0].clientY);
        //socket.emit('alert', idRoom, e);
        e.button = 0;
        var xx = (mouse.x/$(window).width())*ww;
        var yy = (mouse.y/$(window).height())*hh;
        if ((pointIntoFloor({x: xx, y: yy}) || pointIntoCannon({x: xx, y: yy})) && me.status == 3) {
          e.button = 2;
        }
        whenmousedown(e);
      });
      $(document).on("touchend", function(e) {
        // mouse.x = e.touches[0].clientX;
        // mouse.y = e.touches[0].clientY;
        // console.log(e.touches[0].clientX+" || "+e.touches[0].clientY);
        //socket.emit('alert', idRoom, e);
        whenmouseup(e);
      });
      $(document).on("touchmove", function(e) {
        mouse.x = e.touches[0].clientX;
        mouse.y = e.touches[0].clientY;
        //console.log(e.touches[0].clientX+" || "+e.touches[0].clientY);
        //socket.emit('alert', idRoom, e);
        whenmousemove(e);
      });

      function whenmousedown(e) {
        if (e.button == 0 && me.status == 3) {
          var item = onToGuiInvertarBuilt(mouse);
          if (item) {
            gui.inventarBuilt.activeItem = item;
            refreshActiveIntervalBuild(item);

            gui.hintControlChoose.visible = false;
          }
          if (onToGuiBuiltPlace(mouse)) {
            flags.placeBuilt = true;
          }
          if (onToGuiReady() && e.type != "touchstart") {
            if (me.ready) {
              me.ready = false;
              gui.buttonReady.colorText = "#ffffff77";
              //gui.buttonReady.colorBack = "#00c40a77";
            } else {
              me.ready = true;
              gui.buttonReady.colorText = "#ffffff";
              //gui.buttonReady.colorBack = "#00c40a";
            }
            if (me.ready) {
              //buildRestCannons();
            }
            if (enemy.bot) {
              startGameBot();
            } else {
                socket.emit('imready', idRoom, me.side, me.ready);
            }
          }
        } else if (e.button == 2 && me.status == 3) {
          if (onToGuiBuiltPlace(mouse)) {
            delWallUnderMouse();
          }
        } else if (e.button == 0 && me.status == 4 && me.turn) {
          var cannon = onToCannon();
          if (onToGuiBuiltPlace(mouse) && !cannon && me.turn) {
            //flags.placeBuilt = true;
          } else if (onToGuiBuiltPlace(mouse) && cannon && me.turn) {
            //flags.chooseCannon = cannon;
            trueCannonAim(cannon);
          }
          // var cannon = onToCannon();
          // if (onToGuiBuiltPlace(mouse) && cannon) {
          //   chooseCannon(cannon);
          // }
          // if (onToGuiAim(mouse)) {
          //   flags.guiAim = true;
          // }
          // if (onToGuiButtonShot(mouse)) {
          //   flags.guiShot = true;
          // }
        }
      }
      function whenmouseup(e) {
        flags.guiAim = false;
        flags.placeBuilt = false;
        if (me.turn) {
          falseCannonAim();
        }
        if (flags.guiShot && onToGuiButtonShot(mouse)) {
          //shoot();
          flags.guiShot = false;
        }
        for (i in obj) {
          if (obj[i].tag == "floor" && (obj[i].temporary == 2)) {
            obj[i].temporary = 3;
            obj[i].color = "#333";

            var urlWall = me.textures.wall;
            if ( (me.side == 1 && obj[i].coordinate.x > ww/2) || (me.side == 2 && obj[i].coordinate.x < ww/2) ) {
              urlWall = enemy.textures.wall;
            }

            //obj[i].url = "img/wall.png";this comment
            obj[i].url = urlWall;
            if (gui.inventarBuilt.activeItem == "stoneWall") {
              //gui.inventarBuilt.contain[0].counter -= 1;
              addCounter("stoneWall", -1);
            }
          }
          if (obj[i].tag == "floor" && (obj[i].temporary == 1 || obj[i].temporary == 2)) {
            obj.splice(i, 1);
          }



          if (obj[i].tag == "cannon" && (obj[i].temporary == 2)) {
            obj[i].temporary = 3;
            obj[i].color = "#4c52c7";
            if (me.side == 1) {
              obj[i].url = "img/cannonL0.png";
            } else if (me.side == 2) {
              obj[i].url = "img/cannonR0.png";
            }
            if (gui.inventarBuilt.activeItem == "cannon") {
              addCounter("cannon", -1);
            }
          }
          if (obj[i].tag == "cannon" && (obj[i].temporary == 1 || obj[i].temporary == 2)) {
            obj.splice(i, 1);
          }
        }
      }
      function whenmousemove(e) {
        var x = (mouse.x/$(window).width())*ww;
        var y = (mouse.y/$(window).height())*hh;

        if (flags.chooseCannon) {
          moveCannonAim();
        }

        if (flags.guiAim && onToGuiAim(mouse)) {
          if (me.side == 1) {
            gui.aim.turn.coordinate.x = x-gui.aim.coordinate.x;

            for (var i = 0; i < obj.length; i++) {
              if (obj[i].tag == "cannon") {
              if (obj[i].choosen) {
                var angle = radToDeg(Math.atan(gui.aim.turn.coordinate.y/(-gui.aim.turn.coordinate.x)));
                if (angle >= 0 && angle < 15) {
                  obj[i].url = "img/cannonL0.png";
                } else if (angle >= 15 && angle < 37) {
                  obj[i].url = "img/cannonL30.png";
                } else if (angle >= 37 && angle < 53) {
                  obj[i].url = "img/cannonL45.png";
                } else if (angle >= 53 && angle < 75) {
                  obj[i].url = "img/cannonL60.png";
                } else if (angle >= 75 && angle <= 90) {
                  obj[i].url = "img/cannonL90.png";
                }
              } else {
                if (obj[i].coordinate.x < 0.5*ww) {
                  obj[i].url = "img/cannonL0.png";
                } else if (obj[i].coordinate.x > 0.5*ww) {
                  obj[i].url = "img/cannonR0.png";
                }
              }
              }
            }
          } else if (me.side == 2) {
            gui.aim.turn.coordinate.x = x-(ww-gui.aim.coordinate.x);

            for (var i = 0; i < obj.length; i++) {
              if (obj[i].tag == "cannon") {
              if (obj[i].choosen) {
                var angle = radToDeg(Math.atan(gui.aim.turn.coordinate.y/gui.aim.turn.coordinate.x));
                if (angle >= 0 && angle < 15) {
                  obj[i].url = "img/cannonR0.png";
                } else if (angle >= 15 && angle < 37) {
                  obj[i].url = "img/cannonR30.png";
                } else if (angle >= 37 && angle < 53) {
                  obj[i].url = "img/cannonR45.png";
                } else if (angle >= 53 && angle < 75) {
                  obj[i].url = "img/cannonR60.png";
                } else if (angle >= 75 && angle <= 90) {
                  obj[i].url = "img/cannonR90.png";
                }
              } else {
                if (obj[i].coordinate.x < 0.5*ww) {
                  obj[i].url = "img/cannonL0.png";
                } else if (obj[i].coordinate.x > 0.5*ww) {
                  obj[i].url = "img/cannonR0.png";
                }
              }
              }
            }
          }
          gui.aim.turn.coordinate.y = y-gui.aim.coordinate.y;
        }

        if (flags.placeBuilt && onToGuiBuiltPlace(mouse)) {
            if (gui.inventarBuilt.activeItem == "stoneWall" && getCounter("stoneWall") != 0) {
              for (i in obj) {
                if (obj[i].tag == "floor" && (obj[i].temporary == 1 || obj[i].temporary == 2)) {
                  obj.splice(i, 1);
                }
              }
              var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
              var addWall = 0;
              if (isphone) {
                addWall = 0.2*hh;
              }
              var urlWall = me.textures.wall;
              if ( (me.side == 1 && x > ww/2) || (me.side == 2 && x < ww/2) ) {
                urlWall = enemy.textures.wall;
              }
              var wall = {
                tag: "floor",
                temporary: 1,
                coordinate: {
                  x: x,
                  y: y+addWall
                },
                size: {
                  w: 0.075*ww,
                  h: 0.15*hh
                },
                deg: 0,
                //url: "img/wall.png",
                url: urlWall,
                color: "#cc000077"
              };
              var tempType = wallIsCorrect(wall);
              obj.push(wall);
            } else if (gui.inventarBuilt.activeItem == "cannon" && getCounter("cannon") != 0) {
              for (i in obj) {
                if (obj[i].tag == "cannon" && (obj[i].temporary == 1 || obj[i].temporary == 2)) {
                  obj.splice(i, 1);
                }
              }
              var imgurl = "";
              if (me.side == 1) {
                imgurl = "img/cannonL0Ban.png";
              } else if (me.side == 2) {
                imgurl = "img/cannonR0Ban.png";
              }
              var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
              var addCannon = 0;
              if (isphone) {
                addCannon = 0.2*hh;
              }
              var cannon = {
                tag: "cannon",
                temporary: 1,
                coordinate: {
                  x: x,
                  y: y+addCannon
                },
                size: {
                  w: 0.1*ww,
                  h: 0.1*hh
                },
                url: imgurl,
                //wheelUrl: "img/items/cannon1_default.png",
                wheelUrl: imgobjitemcannon1,
                //barrelUrl: "img/items/cannon2_default.png",
                barrelUrl: imgobjitemcannon2,
                angle: 0,
                color: "#cc000077"
              };
              var support = cannonIsCorrect(cannon);
              if (support) {
                cannon.coordinate.y += Math.abs(cannon.coordinate.y-support.coordinate.y)-cannon.size.h/2-support.size.h/2;
                if (Math.abs(cannon.coordinate.x-support.coordinate.x) <= 10) {
                  cannon.coordinate.x = support.coordinate.x;
                }
                cannon.temporary = 2;
                cannon.color = "#4c52c777";
                if (me.side == 1) {
                  cannon.url = "img/cannonL0Temporary.png";
                } else if (me.side == 2) {
                  cannon.url = "img/cannonR0Temporary.png";
                }
              }
              obj.push(cannon);
            }
        }
      }

      function buildRestCannons() {
        if (getCounter("cannon") > 0) {
          //build cannons
          var cCannons = getCounter("cannon");
          for (var i = 0; cCannons > 0; i++) {
            var x = getRandom(0, 0.4*ww);
            if (me.side == 2) {
              x = ww-x;
            }
            if (buildCannon(x, me.side)) {
              cCannons--;
              addCounter("cannon", -1);
            }
          }
        }
      }

      // function shoot() {
      //   var muffler = 0.3;
      //   var bullet = {
      //       tag: "bullet",
      //       coordinate: {
      //         x: pointShoot.x,
      //         y: pointShoot.y
      //       },
      //       speed: {
      //         x: gui.aim.turn.coordinate.x*muffler,
      //         y: gui.aim.turn.coordinate.y*muffler
      //       },
      //       r: 8,
      //       color: "#000"
      //   };
      //   if (me.side == 1 && me.turn) {
      //     finishData.shoots.p1++;
      //   } else if (me.side == 2 && me.turn) {
      //     finishData.shoots.p2++;
      //   } else if (me.side == 1 && enemy.turn) {
      //     finishData.shoots.p2++;
      //   } else if (me.side == 2 && enemy.turn) {
      //     finishData.shoots.p1++;
      //   }
      //
      //   var cannonHeight = 108;
      //   var range = Math.abs(bullet.speed.x*((Math.sqrt(3*Math.pow(bullet.speed.y, 2)+2*g.y*cannonHeight)-bullet.speed.y)/g.y));
      //
      //   // if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
      //   //   finishData.ranges.p1.push(range);
      //   // } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
      //   //   finishData.ranges.p2.push(range);
      //   // }
      //
      //   if (enemy.bot) {
      //     obj.push(bullet);
      //     changeTurnBot();
      //   } else {
      //     socket.emit('shoot', bullet, me.side, idRoom);
      //     obj.push(bullet);
      //     socket.emit('changeTurn', idRoom);
      //   }
      //
      // }

      function objectExist(oneobject) {
        for (i in obj) {
          if (JSON.stringify(oneobject) === JSON.stringify(obj[i])) {
            return true
          }
        }
        return false
      }

      drawMenu();
      setGuiMenu();

      //create me
      var me = {
        status: 0
      }
      socket.emit('updateMe', me);

      //create enemy
      var enemy = {};

      //create finish finish data
      var finishData = {
        winner: 0,
        duration: 0,
        shoots: {
          p1: 0,
          p2: 0
        },
        destroyed: {
          p1: 0,
          p2: 0
        },
        percentage: {
          p1: 0,
          p2: 0
        },
        forcesShooting: {
          p1: [],
          p2: []
        },
        averageForcesShooting: {
          p1: 0,
          p2: 0
        },
        addRating: {
          p1: 0,
          p2: 0
        }
        // ranges: {
        //   p1: [],
        //   p2: []
        // },
        // averageRange: {
        //   p1: 0,
        //   p2: 0
        // }
      }

      //all objects
      var obj = [];
      var gui;
      function resetObjects() {
        obj = [{
          tag: "floor",
          temporary: "always",
          coordinate: {
            x: 0.2*ww,
            y: 0.9*hh
          },
          size: {
            w: 0.4*ww,
            h: 0.1*hh
          },
          deg: 0,
          //url: "img/leftSummerGrass.png",
          url: imgobjleftSummerGrass,
          color: "#00c735"
        }, {
          tag: "floor",
          temporary: "always",
          coordinate: {
            x: 0.8*ww,
            y: 0.9*hh
          },
          size: {
            w: 0.4*ww,
            h: 0.1*hh
          },
          deg: 0,
          //url: "img/rightSummerGrass.png",
          url: imgobjrightSummerGrass,
          color: "#00c735"
        }, {
          tag: "area",
          id: "buildArea",
          visible: true,
          color: "#24d60002",
          coordinate: {
            x: 0.2*ww,
            y: 0.55*hh
          },
          size: {
            w: 0.4*ww,
            h: 0.6*hh,
            font: 20
          },
          title: "build into this area",
          colorText: "#fff",
          colorStroke: "#24d600"
        }];

        gui = {
          aim: {
            visible: false,
            coordinate: {
              x: 0.1*ww,
              y: 0.3*hh
            },
            r: 100,
            turn: {
              coordinate: {
                x: 0,
                y: 0
              },
              color: "#cc000099",
              r: 10
            },
            color: "#00000077"
          },
          buttonShot: {
            visible: false,
            coordinate: {
              x: 0.20*ww,
              y: 0.23*hh
            },
            size: {
              w: 0.1*ww,
              h: 0.05*hh,
              font: 32
            },
            color: "#00000099",
            colorText: "#fff",
            title: "shoot"
          },
          inventarBuilt: {
            visible: true,
            activeItem: "stoneWall",
            coordinate: {
              x: 100,
              y: 100
            },
            margin: 20,
            contain: [
              // {name: "stoneWall", color: "#333", url: "img/wallIco.png", counter: 3, active: true},
              // {name: "cannon", color: "#4c52c7", url: "img/cannonIco.png", counter: 2, active: false}
              {name: "stoneWall", color: "#333", url: imgobjwallIco, counter: 3, active: true},
              {name: "cannon", color: "#4c52c7", url: imgobjcannonIco, counter: 2, active: false}
            ],
            sizeIco: {
              w: 50,
              h: 50
            }
          },
          timer: {
            val: 60,
            visible: 1,
            coordinate: {
              x: 0.5*ww,
              y: 0.1*hh
            },
            size: {
              w: 0.1*ww,
              font: 32
            },
            color: "#fff",
            pause: false
          },
          buttonReady: {
            visible: 1,
            coordinate: {
              x: 0.5*ww,
              y: 0.15*hh
            },
            title: "I'm ready",
            size: {
              w: 0.1*ww,
              h: 0.05*hh,
              font: 26
            },
            colorText: "#ffffff77",
            //urlBack: "img/imready.png",
            urlBack: imgobjimready,
            colorBack: "#00c40a77"
          },
          hintControl: {
            visible: 1,
            coordinate: {
              x: 0.1*ww,
              y: 0.35*hh
            },
            title: "Build object",
            size: {
              imgw: 100,
              imgh: 100,
              font: 26
            },
            colorText: "#ffffff",
            //url: "img/leftClick.png"
            url: imgobjleftClick
          },
          hintControlRClick: {
            visible: 1,
            coordinate: {
              x: 0.1*ww,
              y: 0.5*hh
            },
            title: "Remove object",
            size: {
              imgw: 100,
              imgh: 100,
              font: 26
            },
            colorText: "#ffffff",
            //url: "img/rightClick.png"
            url: imgobjrightClick
          },
          hintControlChoose: {
            visible: 1,
            coordinate: {
              x: 130,
              y: 180
            },
            size: {
              imgw: 180,
              imgh: 100
            },
            //url: "img/chooseObjects.png"
            url: imgobjchooseObjects
          },
          labelChooseCannon: {
            visible: false,
            coordinate: {
              x: 0.2*ww,
              y: 0.45*hh
            },
            size: {
              w: 0.4*ww,
              font: 26
            },
            colorText: "#fff",
            title: "choose your cannon by click on a one of them"
          },
          labelYourTurn: {
            visible: false,
            coordinate: {
              x: 0.5*ww,
              y: 0.15*hh
            },
            size: {
              w: 0.4*ww,
              font: 26
            },
            colorText: "#fff",
            title: ""
          },
          labelNameL: {
            visible: false,
            coordinate: {
              x: 0.35*ww,
              y: 0.15*hh
            },
            size: {
              w: 0.2*ww,
              font: 20
            },
            colorText: "#fff",
            title: ""
          },
          labelNameR: {
            visible: false,
            coordinate: {
              x: ww-0.35*ww,
              y: 0.15*hh
            },
            size: {
              w: 0.4*ww,
              font: 20
            },
            colorText: "#fff",
            title: ""
          },
          vectorShoot: {
            visible: false,
            coor1: {
              x: 0,
              y: 0
            },
            coor2: {
              x: 0,
              y: 0
            },
            color: "#ee0000",
            shift: 0
          },
          circleShoot: {
            visible: false,
            coordinate: {
              x: 0,
              y: 0
            },
            radius: 100,
            scale: {
              x: 1,
              y: 1
            },
            dot: {
              radius: 3,
              frequency: 30,
              color: "#fff"
            },
            shift: 0,
            speedAnimation: 0
          }
        };
      }

      // function offAreaBuild() {
      //   for (i in obj) {
      //     if (obj[i].tag == "area" && obj[i].id == "buildArea") {
      //       obj[i].visible = false;
      //       break;
      //     }
      //   }
      //
      //   gui.hintControl.visible = false;
      //   gui.hintControlRClick.visible = false;
      //   gui.hintControlChoose.visible = false;
      //
      //   gui.labelNameL.visible = true;
      //   gui.labelNameR.visible = true;
      // }

      function offAreaBuild(flag) {
        var tf = false;
        if (flag == "1") {
          tf = true;
        } else if (flag == "2") {
          tf = false;
        }
        for (i in obj) {
          if (obj[i].tag == "area" && obj[i].id == "buildArea") {
            obj[i].visible = tf;
            break;
          }
        }

        gui.hintControl.visible = false;
        gui.hintControlRClick.visible = false;
        gui.hintControlChoose.visible = false;

        gui.labelNameL.visible = true;
        gui.labelNameR.visible = true;
      }

      var g = {x: 0, y: 0.3}; //acceleration free-falling
      var ar = 0.0000; //acceleration air resistance

      var additionalGlobal = "";
      var textMenu = "press 1 to start";
      var idRoom = "";
      var defaultTextures = {
        //cannon1: "img/items/cannon1_default.png",
        cannon1: imgobjitemcannon1,
        //cannon2: "img/items/cannon2_default.png",
        cannon2: imgobjitemcannon2,
        //wall: "img/items/wall_default.png",
        wall: imgobjitemwall
      }
      socket.on('sendNewData', function(data) {
        idRoom = data.room;
        if (data.me.status == 0) {
          me = {};
          enemy = {};
          textMenu = "press 1 to start";
          drawMenu();
          setGuiMenu();
          if (mid && mid != "") {
            socket.emit('decryptMail', mid);
          } else {
            $("#signButton").css("display", "flex");
          }
          additional = getCookie("additional");
          if (additional && additional != "") {
            socket.emit('decryptAdditional', additional);
            socket.on('sendDecryptAdditional', function(add) {
              additionalGlobal = add;
              var addd = add.split(";");
              for (var i = 0; i < addd.length; i++) {
                var curr = addd[i].split("=");
                if (curr[0] == "rating" && parseInt(curr[1]) > 100) {
                  $("#signButton").html("<span style='margin:0px;'>Sign in/up</span><span style='max-width:100px;margin:0px;font-size:10px;color:#ff7b7b;font-style:italic'>if you register you will get "+curr[1]+" rating point and items if you have</span>");
                  $("#signButton").css("padding", "10px");
                  break;
                }
              }
            });
          }

          cookieAcceptance = getCookie("cookieAcceptance");
          if (cookieAcceptance && cookieAcceptance == "1") {
              closeCA(false);
          }

          resetObjects();
          flagShowBuilding = true;
        } else if (data.me.status == 3) {
          if (Object.entries(enemy).length === 0) {
            $("#note").remove();
            $("#gui").remove();
            animateSearchButton(false);
            timerBot(false);
            draw();
            setGui();
            resetObjects();
          }
        }
        me = data.me;
        enemy = data.enemy;

        //iduser
        if (iduser != "!noid") {
          socket.emit('getMyRrating', iduser);
        } else if (iduser == "!noid") {
          me.rating = 100;
          socket.emit('giveMyRatingToEnemy', idRoom, me.side, me.rating);
        }
        if (enemy.bot) {
          enemy.rating = 100;
        }
        me.id = iduser;
        socket.emit('giveMyIdToEnemy', idRoom, me.side, iduser);

        if (data.me.status == 3) {
          setTextures();
        }
  		});

      socket.on('sendRating', function(rating) {
        me.rating = rating;
        socket.emit('giveMyRatingToEnemy', idRoom, me.side, me.rating);
      });

      socket.on('sendEnemyRating', function(rating) {
        if (enemy.bot) {
          rating = 100;
        }
        enemy.rating = rating;
      });

      socket.on('sendEnemyId', function(id) {
        if (enemy.bot) {
          enemy.id = "!noid";
        } else {
          enemy.id = id;
        }
      });

      socket.on('sendServerSignEmail', function(is, confirm, email) {
        $("#wrapSignAnswerEmail").show();
        if (is) {
          $("#textSignAnswer1").html("<b>"+email+"</b> is found");

          $("#submitSignAnswer1").attr("mail", email);
          $("#submitSignAnswer1").attr("act", "signin");
          $("#submitSignAnswer1").html("enter");

          $("#wrapSignAnswerEmail1").show();
        } else if (!is) {
          $("#textSignAnswer1").html("<b>"+email+"</b> is new here");

          $("#submitSignAnswer1").attr("mail", email);
          $("#submitSignAnswer1").attr("act", "signup");
          $("#submitSignAnswer1").html("register it");

          $("#wrapSignAnswerEmail1").show();
        }
      });

      socket.on('sendAnswer2Signup', function(success, text) {

        $("#wrapSignAnswerEmail1").hide();

        if (success) {
          $("#textSignAnswer2").css("color", "#3bb333");
        } else if (!success) {
          $("#textSignAnswer2").css("color", "#ff5252");
        }

        $("#textSignAnswer2").html(text);
        $("#wrapSignAnswerEmail2").show();
      });

      socket.on('sendIdRoom', function(id) {
        idRoom = id;
      });

      socket.on('sendChangeAngle', function(cannon) {
        for (var i = 0; i < obj.length; i++) {
          if (obj[i].tag == "cannon" && obj[i].coordinate.x == cannon.coordinate.x && obj[i].coordinate.y == cannon.coordinate.y) {
            obj[i].angle = cannon.angle;
            break;
          }
        }
      });

      socket.on('sendShoot', function(bullet) {
        if (me.side == 1 && me.turn) {
          finishData.shoots.p1++;
        } else if (me.side == 2 && me.turn) {
          finishData.shoots.p2++;
        } else if (me.side == 1 && enemy.turn) {
          finishData.shoots.p2++;
        } else if (me.side == 2 && enemy.turn) {
          finishData.shoots.p1++;
        }

        var cannonHeight = 108;
        var range = Math.abs(bullet.speed.x*((Math.sqrt(3*Math.pow(bullet.speed.y, 2)+2*g.y*cannonHeight)-bullet.speed.y)/g.y));

        // if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
        //   finishData.ranges.p1.push(range);
        // } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
        //   finishData.ranges.p2.push(range);
        // }

        var muffler = 0.1;
        var forceShoot = Math.round(Math.sqrt(Math.pow(bullet.speed.x/muffler, 2)+Math.pow(bullet.speed.y/muffler, 2))*100)/100;
        if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
          finishData.forcesShooting.p1.push(forceShoot);
        } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
          finishData.forcesShooting.p2.push(forceShoot);
        }

        obj.push(bullet);
  		});

      socket.on('sendReady', function(sign) {
        enemy.ready = sign;
        if (me.ready && enemy.ready) {
          //startgame
          socket.emit('startGame', idRoom);
        }
  		});

      socket.on('sendStartGame', function() {
        me.ready = true;
        enemy.ready = true;
        gui.timer.pause = true;
        gui.timer.val = 0;
        gui.inventarBuilt.visible = false;
        gui.buttonReady.visible = false;
        buildRestCannons();
        socket.emit('showMyBuilding', idRoom, me.side, obj);
        offAreaBuild();
        if (me.side == 1) {
          me.turn = true;
          enemy.turn = false;
        } else if (me.side == 2) {
          me.turn = false;
          enemy.turn = true;
        }
  		});

      var flagShowBuilding = true;
      socket.on('sendBuildingEnemy', function(objects) {
        // console.log(objects);
        if (flagShowBuilding) {
          for (var i = 0; i < objects.length; i++) {
            if (!objectExist(objects[i]) && objects[i].tag != "area") {
              obj.push(objects[i]);
            }
          }

          flagShowBuilding = false;
        }

        if (me.side == 1) {
          socket.emit('changeTurn', idRoom);
        }
  		});

      var flagHintChooseCannon = true;

      socket.on('sendChangeTurn', function() {
        if (me.status == 3 || enemy.status == 3) {
          me.status = 4;
          enemy.status = 4;
          if (me.side == 1) {
            me.turn = true;
            enemy.turn = false;
          } else if (me.side == 2) {
            me.turn = false;
            enemy.turn = true;
          }
        } else if (me.status == 4 && me.status == 4) {
            if (me.turn == false) {
              me.turn = true;
              enemy.turn = false;
            } else if (me.turn == true) {
              me.turn = false;
              enemy.turn = true;
            }
            finishData.duration += 30-gui.timer.val;
        }
        gui.aim.visible = false;
        gui.buttonShot.visible = false;
        gui.timer.val = 30;
        gui.timer.pause = false;
        paintChoose();

        if (flagHintChooseCannon && me.turn) {
          gui.labelChooseCannon.visible = true;
          flagHintChooseCannon = false;
        }

        gui.labelYourTurn.visible = true;
  		});

      socket.on('sendOnline', function(length) {
        console.log(length);
  		});

      socket.on('sendPOST', function(body) {
        console.log(body);
  		});

      function setTextures() {
        me.textures = {};
        enemy.textures = {};
        if (iduser != "!noid") {
          socket.emit('getTextures', iduser);
          socket.on('sendTextures', function(nTextu) {
            var namesTexturies = nTextu.split("~~");
            // me.textures.cannon1 = "img/items/cannon1_"+namesTexturies[0]+".png";
            // me.textures.cannon2 = "img/items/cannon2_"+namesTexturies[1]+".png";
            // me.textures.wall = "img/items/wall_"+namesTexturies[2]+".png";
            var testtestimg = new Image();
            testtestimg.src = "/g/cannons/img/items/cannon1_"+namesTexturies[0]+".png";
            me.textures.cannon1 = testtestimg;
            testtestimg = new Image();
            testtestimg.src = "/g/cannons/img/items/cannon2_"+namesTexturies[1]+".png";
            me.textures.cannon2 = testtestimg;
            testtestimg = new Image();
            testtestimg.src = "/g/cannons/img/items/wall_"+namesTexturies[2]+".png";
            me.textures.wall = testtestimg;

            var linksToImg = ["/g/cannons/img/items/cannon1_"+namesTexturies[0]+".png", "/g/cannons/img/items/cannon2_"+namesTexturies[1]+".png", "/g/cannons/img/items/wall_"+namesTexturies[2]+".png"];

            if (!enemy.bot) {
              socket.emit('sendEnemyTextures', idRoom, me.side, linksToImg);
            } else if (enemy.bot) {
              enemy.textures = defaultTextures;
            }
      		});
        } else if (iduser == "!noid") {

          me.textures = defaultTextures;

          var linksToImg = ["/g/cannons/img/items/cannon1_default.png", "/g/cannons/img/items/cannon2_default.png", "/g/cannons/img/items/wall_default.png"];

          if (!enemy.bot) {
            socket.emit('sendEnemyTextures', idRoom, me.side, linksToImg);
          } else if (enemy.bot) {
            enemy.textures = defaultTextures;
          }
        }
      }

      socket.on('takeEnemyRating', function(objTextu) {
        //enemy.textures = objTextu;
        var testtestimg = new Image();
        testtestimg.src = objTextu[0];
        enemy.textures.cannon1 = testtestimg;
        testtestimg = new Image();
        testtestimg.src = objTextu[1];
        enemy.textures.cannon2 = testtestimg;
        testtestimg = new Image();
        testtestimg.src = objTextu[2];
        enemy.textures.wall = testtestimg;
      });

      var intervalAnimateSearchButton;
      function animateSearchButton(key) {
        if (key == 1) {
          $("#searchGame").css("opacity", "0.4");
          intervalAnimateSearchButton = setTimeout(function() {
            animateSearchButton(2);
          }, 1000);
        } else if (key == 2) {
          $("#searchGame").css("opacity", "1");
          intervalAnimateSearchButton = setTimeout(function() {
            animateSearchButton(1);
          }, 1000);
        } else if (key == 0) {
          $("#searchGame").css("opacity", "1");
          clearInterval(intervalAnimateSearchButton);
        }
      }

      function getRandom(min, max) {
        return Math.random()*(max-min)+min;
      }

      function getRandomInt(min, max) {
        return Math.floor(Math.random()*(max - min))+min;
      }

      var delayBot = 12*1000;
      var timerPlayBot = setTimeout(function() {});
      function timerBot(key) {
        clearInterval(timerPlayBot);
        if (key) {
          timerPlayBot = setTimeout(function() {
            socket.emit('startRoomBot', idRoom);
          }, delayBot);
        }
      }

      //searching Game
      function switchSearch() {
        if (me.status == 0) {
          me.status = 1;
          $("#searchGame").html("Searching game");
          animateSearchButton(true);
          timerBot(true);
          me.name = $("#inputName").val();
          socket.emit('updateMe', me);
        } else if (me.status == 1) {
          me.status = 0;
          $("#note").remove();
          $("#searchGame").html("Search game");
          animateSearchButton(false);
          timerBot(false);
          me.name = $("#inputName").val();
          socket.emit('updateMe', me);
        }
      }

      socket.on('sendWinner', function(data) {
        gui.timer.pause = true;
        gui.timer.val = 0;
        gui.timer.visible = false;
        gui.labelYourTurn.visible = false;
        gui.labelNameL.visible = false;
        gui.labelNameR.visible = false;
        $("#gui").remove();
        me.status = 5;
        enemy.status = 5;

        //new rating
        var mathexpect = 1/(1+Math.pow(10, ((enemy.rating-me.rating)/400)));
        var winpoint = 0;
        if ((finishData.winner == 1 && me.side == 1) || (finishData.winner == 2 && me.side == 2)) {
          winpoint = 1;
        }
        var k = 10;
        var addRating = Math.round(k*(winpoint-mathexpect));
        var signAddRating = "+";
        var colorRating = "#67ff65";
        if (addRating < 0) {
          signAddRating = "-";
          colorRating = "#ff6565";
        } else if (addRating == 0) {
          colorRating = "#fff";
        }
        //var newrating = me.rating+addRating;

        //console.log("r = "+me.rating+" + "+k+"*("+winpoint+"-"+mathexpect+")");
        //end new rating

        $("body").append("<div id='guiFinishGame'></div>");
        $("#guiFinishGame").css("position", "absolute");

        $("#guiFinishGame").append("<div id='backFinishGame'></div>");
        $("#backFinishGame").css("position", "fixed");
        $("#backFinishGame").css("left", "0px");
        $("#backFinishGame").css("top", "0px");
        $("#backFinishGame").css("width", "100%");
        $("#backFinishGame").css("height", "100%");
        $("#backFinishGame").css("display", "block");
        $("#backFinishGame").css("flex-direction", "column");
        $("#backFinishGame").css("align-items", "center");
        $("#backFinishGame").css("justify-content", "center");
        $("#backFinishGame").css("background-color", "#00000077");
        $("#backFinishGame").css("overflow-y", "auto");

        $("#backFinishGame").append("<div id='wrapFinishGame'></div>");
        $("#wrapFinishGame").css("display", "flex");
        $("#wrapFinishGame").css("max-width", "500px");
        $("#wrapFinishGame").css("flex-direction", "column");
        $("#wrapFinishGame").css("align-items", "center");
        $("#wrapFinishGame").css("justify-content", "center");
        $("#wrapFinishGame").css("min-height", "100%");
        $("#wrapFinishGame").css("margin", "0px auto");

        var text = "";
        var color = "";
        if (me.side == data.winner) {
          text = "Congratulation, you win. ^_^ ";
          color = "#67ff65";
        } else if (me.side != data.winner) {
          text = "That's okay, but you lose. T_T";
          color = "#ff6565";
        }
        if (!data.averageForcesShooting.p1) {
          data.averageForcesShooting.p1 = "none";
        }
        if (!data.averageForcesShooting.p2) {
          data.averageForcesShooting.p2 = "none";
        }

        $("#wrapFinishGame").append("<div id='guiFGText'>"+text+"</div>");
        $("#guiFGText").css("font-family", "Arial");
        $("#guiFGText").css("font-size", "min(10vh, 32px)");
        $("#guiFGText").css("margin", "3vh 20px");
        $("#guiFGText").css("text-align", "center");
        $("#guiFGText").css("color", color);

        $("#wrapFinishGame").append("<div id='guiFGRating'><span style='color:#999;text-align:right;font: 12px Arial;font-style:italic;vertical-align: middle;'>Change rating:</span> "+me.rating+" <span style='color:"+colorRating+";'>"+signAddRating+" "+Math.abs(addRating)+"</span> = <span style='color:"+colorRating+";'>"+(me.rating+addRating)+"</span></div>");
        $("#guiFGRating").css("font-family", "Arial");
        $("#guiFGRating").css("font-size", "min(8vh, 26px)");
        $("#guiFGRating").css("font-weight", "bold");
        $("#guiFGRating").css("margin", "3vh 20px");
        $("#guiFGRating").css("text-align", "center");
        $("#guiFGRating").css("color", "#fff");
        if (me.id != "!noid" && me.id == enemy.id) {$("#guiFGRating").hide();}

        $("#wrapFinishGame").append("<div id='fortuneFG'></div>");
        $("#fortuneFG").css("width", "90%");
        $("#fortuneFG").css("height", "100px");//3vh
        $("#fortuneFG").css("max-width", "500px");
        //$("#fortuneFG").css("max-height", "100px");
        $("#fortuneFG").css("margin", "1vh 0px");
        $("#fortuneFG").css("background-color", "#000");
        $("#fortuneFG").css("white-space", "nowrap");
        $("#fortuneFG").css("overflow", "hidden");
        $("#fortuneFG").css("padding", "10px");
        $("#fortuneFG").css("border-radius", "10px");
        $("#fortuneFG").css("-webkit-border-radius", "10px");
        $("#fortuneFG").css("-moz-border-radius", "10px");
        $("#fortuneFG").css("-o-border-radius", "10px");

        $("#fortuneFG").html("<div id='wrapArrowFG'><div id='arrowFortuneFG'></div></div>");

        $("#wrapArrowFG").css("position", "absolute");
        $("#wrapArrowFG").css("width", "41px");
        $("#wrapArrowFG").css("height", "20px");
        $("#wrapArrowFG").css("overflow", "hidden");
        $("#wrapArrowFG").css("margin-top", "90px");
        $("#wrapArrowFG").css("margin-left", "35px");

        $("#arrowFortuneFG").css("width", "30px");
        $("#arrowFortuneFG").css("height", "30px");
        $("#arrowFortuneFG").css("background-color", "#fff");
        $("#arrowFortuneFG").css("transform", "rotate(45deg)");
        $("#arrowFortuneFG").css("margin-top", "6px");
        $("#arrowFortuneFG").css("margin-left", "6px");

        $("#fortuneFG").hide();
        $("#wrapArrowFG").hide();
        $("#getItemFortune").hide();

        $("#wrapFinishGame").append("<div id='getItemFortune'><div id='nameGetItemFortune'></div><div id='rareGetItemFortune'></div></div>");
        $("#getItemFortune").css("margin-bottom", "50px");

        $("#nameGetItemFortune").css("font-size", "20px");
        $("#nameGetItemFortune").css("font-family", "Arial");
        $("#nameGetItemFortune").css("color", "#fff");
        $("#nameGetItemFortune").css("text-align", "center");
        $("#nameGetItemFortune").css("height", "24px");

        $("#rareGetItemFortune").css("font-size", "12px");
        $("#rareGetItemFortune").css("font-family", "Arial");
        $("#rareGetItemFortune").css("color", "#fff");
        $("#rareGetItemFortune").css("text-align", "center");
        $("#rareGetItemFortune").css("height", "14px");


        $("#wrapFinishGame").append("<div id='buttonShowAllFD'>+ all details</div>");
        $("#buttonShowAllFD").attr("onclick", "showAllDetails()");
        $("#buttonShowAllFD").css("margin", "2vh 20px");
        $("#buttonShowAllFD").css("cursor", "pointer");
        $("#buttonShowAllFD").css("font-family", "Arial");
        $("#buttonShowAllFD").css("font-size", "14px");
        $("#buttonShowAllFD").css("color", "#fff");
        $("#buttonShowAllFD").css("background-color", "#e4a635");
        $("#buttonShowAllFD").css("padding", "5px 10px");
        $("#buttonShowAllFD").css("border-radius", "10px");

        $("#wrapFinishGame").append("<div id='wrapTableInFG'></div>");
        $("#wrapTableInFG").css("overflow", "hidden");
        $("#wrapTableInFG").css("max-height", "0px");
        $("#wrapTableInFG").css("transition", "all ease 0.3s");
        $("#wrapTableInFG").css("-moz-transition", "all ease 0.3s");
        $("#wrapTableInFG").css("-o-transition", "all ease 0.3s");
        $("#wrapTableInFG").css("-webkit-transition", "all ease 0.3s");

        $("#wrapTableInFG").append("<table id='guiFGTable'><tbody id='guiFGTbody'></tbody></table>");
        $("#guiFGTable").css("text-align", "center");
        $("#guiFGTable").css("font", "20px Arial");
        $("#guiFGTable").css("color", "#fff");
        $("#guiFGTable").css("border-spacing", "0px");

        $("#guiFGTbody").append("<tr></tr>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td></td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;font: 12px Arial;font-style:italic;'>Left side</td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;font: 12px Arial;font-style:italic;'>Right side</td>");

        $("#guiFGTbody").append("<tr></tr>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;text-align:right;font: 12px Arial;font-style:italic;'>Duration game: </td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td colspan='2'>"+secToMin(data.duration).split(":")[0]+" min "+secToMin(data.duration).split(":")[1]+" sec</td>");

        $("#guiFGTbody").append("<tr></tr>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;text-align:right;font: 12px Arial;font-style:italic;'>Destroyed cannons: </td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+data.destroyed.p1+"</td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+data.destroyed.p2+"</td>");

        $("#guiFGTbody").append("<tr></tr>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;text-align:right;font: 12px Arial;font-style:italic;'>Hit percentage: </td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+(data.percentage.p1*100)+"%</td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+(data.percentage.p2*100)+"%</td>");

        $("#guiFGTbody").append("<tr></tr>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td style='color:#999;text-align:right;font: 12px Arial;font-style:italic;'>Average force shooting: </td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+data.averageForcesShooting.p1+"</td>");
        $("#guiFGTbody tr").eq($("#guiFGTbody tr").length-1).append("<td>"+data.averageForcesShooting.p2+"</td>");

        $("#guiFGTbody tr td").css("padding", "1vh");

        $("#wrapFinishGame").append("<div onclick='exitToMenu()' id='buttonExitRoom'>Exit to menu</div>");
        $("#buttonExitRoom").css("margin", "2vh 0px");
        $("#buttonExitRoom").css("padding", "min(2vh, 20px) 20px");
        $("#buttonExitRoom").css("cursor", "pointer");
        $("#buttonExitRoom").css("font", "14px Arial");
        $("#buttonExitRoom").css("color", "#fff");
        $("#buttonExitRoom").css("background-color", "#ff5e5e");
        $("#buttonExitRoom").css("border-radius", "10px");

        //fortune

          socket.emit('getItemIdonHave', iduser);
          socket.on('sendItemYouDontHave', function(itemsStroke) {
            insertFortune = itemsStroke;
            socket.emit('getCounterUsers', iduser);
          });
          socket.on('sendCounterUsers', function(allusers) {
            counterAllUsers = parseInt(allusers);
            if (counterAllUsers < 5000) { counterAllUsers = 5000; }

            if (iduser == "!noid") {
              var dc = 0;
              if (me.side == 1) {
                dc = data.destroyed.p1;
              } else if (me.side == 2) {
                dc = data.destroyed.p2;
              }

              //fortune
              var getItemFortune = "";
              if (winpoint == "1" && insertFortune != "") {
                fillFortune(insertFortune);
                getItemFortune = ","+twistFortune($("#fortuneFG"));
              }
              //endfortune

              var datacookie = "rating="+(100+addRating)+";games=1;win="+winpoint+";destroyedCannons="+dc+";items=1,2,3"+getItemFortune;
              socket.emit('cookieAdditionalData', datacookie);
              socket.on('sendEncryptAdditionalData', function(code) {
                setCookie("additional", code, 3);
              });
            } else if (iduser != "!noid" && me.id != enemy.id) {
              socket.emit('addDataUser', iduser, "rating", addRating);
              socket.emit('addDataUser', iduser, "games", 1);
              if (winpoint == 1) {
                socket.emit('addDataUser', iduser, "win", 1);
              }
              if (me.side == 1) {
                socket.emit('addDataUser', iduser, "destroyedCannons", data.destroyed.p1);
              } else if (me.side == 2) {
                socket.emit('addDataUser', iduser, "destroyedCannons", data.destroyed.p2);
              }

              //fortune
              var getItemFortune = "";
              if (winpoint == "1" && insertFortune != "") {
                fillFortune(insertFortune);
                getItemFortune = twistFortune($("#fortuneFG"));
                if (getItemFortune != "0") {
                  socket.emit('addItemUser', iduser, getItemFortune);
                }
              }
              //endfortune
            }

          });
        //end fortune
  		});

      function makefullscreen() {

        if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
          } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
          }

          screen.orientation.lock("landscape-primary");//this code

          //$("#fullscreenButton").html("Back to the standard mode");
          $("#fullscreenButton").hide();
        } else {
          // if (document.exitFullscreen) {
          //   document.exitFullscreen();
          // } else if (document.msExitFullscreen) {
          //   document.msExitFullscreen();
          // } else if (document.mozCancelFullScreen) {
          //   document.mozCancelFullScreen();
          // } else if (document.webkitExitFullscreen) {
          //   document.webkitExitFullscreen();
          // }

          //$("#fullscreenButton").html("Use full screen for phone. This is comfortable");
          //$("#fullscreenButton").show();
        }
      }

      function exitToMenu() {
        socket.emit('exitToMenu');

        //grecaptcha.reset(widgetRecaptcha2);
        finishData = {
          winner: 0,
          duration: 0,
          shoots: {
            p1: 0,
            p2: 0
          },
          destroyed: {
            p1: 0,
            p2: 0
          },
          percentage: {
            p1: 0,
            p2: 0
          },
          forcesShooting: {
            p1: [],
            p2: []
          },
          averageForcesShooting: {
            p1: 0,
            p2: 0
          },
          addRating: {
            p1: 0,
            p2: 0
          }
        }
        //location.reload();
      }

      function bulletIntoHole(bullet) {
        for (i in obj) {
          if (obj[i].tag == "hole") {
            var distance = Math.sqrt(Math.pow(bullet.coordinate.x-obj[i].coordinate.x, 2)+Math.pow(bullet.coordinate.y-obj[i].coordinate.y, 2));
            if (distance <= Math.abs(bullet.r-obj[i].r)) {
              return true;
            }
          }
        }
        return false;
      }

      function secToMin(sec) {
        return Math.trunc(sec/60)+":"+(sec%60)
      }

      function startGameBot() {
        me.ready = true;
        enemy.ready = true;
        gui.timer.pause = true;
        gui.timer.val = 0;
        gui.inventarBuilt.visible = false;
        gui.buttonReady.visible = false;
        // socket.emit('showMyBuilding', idRoom, me.side, obj);

        buildBot();

        buildRestCannons();

        if (me.side == 1) {
          me.turn = true;
          enemy.turn = false;
        } else if (me.side == 2) {
          me.turn = false;
          enemy.turn = true;
        }

        changeTurnBot();

        offAreaBuild();
      }

      function changeTurnBot() {
        if (me.status == 3 || enemy.status == 3) {
          me.status = 4;
          enemy.status = 4;
          if (me.side == 1) {
            me.turn = true;
            enemy.turn = false;
          } else if (me.side == 2) {
            me.turn = false;
            enemy.turn = true;
          }
        } else if (me.status == 4 && enemy.status == 4) {
            if (me.turn == false) {
              me.turn = true;
              enemy.turn = false;
            } else if (me.turn == true) {
              me.turn = false;
              enemy.turn = true;
            }
            finishData.duration += 30-gui.timer.val;
        }
        if (enemy.turn && enemy.bot) {
          shootBot();
        }
        gui.aim.visible = false;
        gui.buttonShot.visible = false;
        gui.timer.val = 30;
        gui.timer.pause = false;
        paintChoose();

        if (flagHintChooseCannon && me.turn) {
          gui.labelChooseCannon.visible = true;
          flagHintChooseCannon = false;
        }

        gui.labelYourTurn.visible = true;
      }

      var intervalDelayShootBot = setTimeout(function() {});
      function shootBot() {

        clearInterval(intervalDelayShootBot);//delay
        intervalDelayShootBot = setTimeout(function() {

          //get ids 'fromto' cannon
          // var lengthMyCannon = 0;
          // for (i in obj) {
          //   if (obj[i]) {
          //     if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && me.side == 1) || (obj[i].coordinate.x > 0.5*ww && me.side == 2) ) ) {
          //       lengthMyCannon++;
          //     }
          //   }
          // }
          // var lengthEnemyCannon = 0;
          // for (i in obj) {
          //   if (obj[i]) {
          //     if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[i].coordinate.x > 0.5*ww && enemy.side == 2) ) ) {
          //       lengthEnemyCannon++;
          //     }
          //   }
          // }
          // var idMyCannon = getRandomInt(0, lengthMyCannon);
          // var idBotCannon = getRandomInt(0, lengthEnemyCannon);
          //
          // var coordinateMyCannon = {x: 0, y:0};
          // var coordinateBotCannon = {x: 0, y:0};
          // var currid = 0;
          // for (i in obj) {
          //   if (obj[i]) {
          //     if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && me.side == 1) || (obj[i].coordinate.x > 0.5*ww && me.side == 2) ) ) {
          //       if (currid == idBotCannon) {
          //         coordinateMyCannon.x = obj[i].coordinate.x;
          //         coordinateMyCannon.y = obj[i].coordinate.y;
          //         break;
          //       }
          //       currid++;
          //     }
          //   }
          // }
          // currid = 0;
          // for (i in obj) {
          //   if (obj[i]) {
          //     if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[i].coordinate.x > 0.5*ww && enemy.side == 2) ) ) {
          //       if (currid == idBotCannon) {
          //         coordinateBotCannon.x = obj[i].coordinate.x;
          //         coordinateBotCannon.y = obj[i].coordinate.y;
          //         break;
          //       }
          //       currid++;
          //     }
          //   }
          // }
          //
          // console.log(coordinateMyCannon);
          // console.log(coordinateBotCannon);
          // var muffler = 0.2;
          // var h1 = coordinateBotCannon.y;
          // var h2 = coordinateMyCannon.y;
          // var d = Math.abs(coordinateMyCannon.x-coordinateBotCannon.x);
          // var vx = getRandom(20, 80)*muffler;
          // if (enemy.side == 2) {
          //   vx = -vx;
          // }
          // var vy = -((d/vx)+(Math.sqrt((3*Math.pow(d/vx, 2)) + (4*(h1+h2)/g.y))))/(2/g.y);


          var lengthBotCannon = 0;
          for (i in obj) {
            if (obj[i]) {
              if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[i].coordinate.x > 0.5*ww && enemy.side == 2) ) ) {
                lengthBotCannon++;
              }
            }
          }
          var idBotCannon = getRandomInt(0, lengthBotCannon);
          var coordinateBotCannon = {x: 0, y:0};
          var currid = 0;
          for (i in obj) {
            if (obj[i]) {
              if (obj[i].tag == "cannon" && ( (obj[i].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[i].coordinate.x > 0.5*ww && enemy.side == 2) ) ) {
                if (currid == idBotCannon) {
                  coordinateBotCannon.x = obj[i].coordinate.x;
                  coordinateBotCannon.y = obj[i].coordinate.y;
                  break;
                }
                currid++;
              }
            }
          }

          var vx = getRandom(50, 200);
          var vy = -getRandom(50, 200);
          if (enemy.side == 2) {
            vx = -vx;
          }

          var muffler = 0.1;
          var bullet = {
              tag: "bullet",
              coordinate: {
                x: coordinateBotCannon.x,
                y: coordinateBotCannon.y
              },
              speed: {
                x: vx*muffler,
                y: vy*muffler
              },
              r: 8,
              color: "#000"
          };
          if (me.side == 1 && me.turn) {
            finishData.shoots.p1++;
          } else if (me.side == 2 && me.turn) {
            finishData.shoots.p2++;
          } else if (me.side == 1 && enemy.turn) {
            finishData.shoots.p2++;
          } else if (me.side == 2 && enemy.turn) {
            finishData.shoots.p1++;
          }

          var force = Math.sqrt(Math.pow(vx, 2)+Math.pow(vy, 2));
          if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
            finishData.forcesShooting.p1.push(Math.round(force*100)/100);
          } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
            finishData.forcesShooting.p2.push(Math.round(force*100)/100);
          }

          var cannonHeight = 108;
          var range = Math.abs(bullet.speed.x*((Math.sqrt(3*Math.pow(bullet.speed.y, 2)+2*g.y*cannonHeight)-bullet.speed.y)/g.y));

          // if ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) {
          //   finishData.ranges.p1.push(range);
          // } else if ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) {
          //   finishData.ranges.p2.push(range);
          // }

          // if (enemy.bot) {
          //   obj.push(bullet);
          //   changeTurnBot();
          // } else {
          //   socket.emit('shoot', bullet, me.side, idRoom);
          //   obj.push(bullet);
          //   socket.emit('changeTurn', idRoom);
          // }

          for (var i = 0; i < obj.length; i++) {
            if (obj[i].tag == "cannon" && obj[i].coordinate.x == coordinateBotCannon.x && obj[i].coordinate.y == coordinateBotCannon.y) {
              obj[i].angle = -Math.atan(Math.abs(vy/vx));
              break;
            }
          }

          obj.push(bullet);
          if (me.status == 4) {
            changeTurnBot();
          }

        }, getRandomInt(1000, 5001));

      }

      function buildBot() {
        var counterWalls = 3;
        var counterCannons = 2;

        //build walls
        for (var i = 0; counterWalls > 0; i++) {
            var typeBuilding = getRandomInt(0, 2);
            if (i == 0) {
              typeBuilding = 0;
            }
            if (typeBuilding == 0) {
                var limit = 4;
                if (counterWalls < 4) {
                  limit = counterWalls;
                }
                var x = getRandom(0, 0.4*ww);
                var h = getRandomInt(1, limit);
                var walls;
                if (enemy.side == 1) {
                  walls = buildColumnWalls(x, h);
                } else if (enemy.side == 2) {
                  walls = buildColumnWalls(ww-x, h);
                }
                counterWalls -= walls;
            } else if (typeBuilding == 1) {
                var lengthMyWalls = 0;
                for (j in obj) {
                  if (obj[j]) {
                    if (obj[j].tag == "floor" && ( (obj[j].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[j].coordinate.x > 0.5*ww && enemy.side == 2) ) ) {
                      lengthMyWalls++;
                    }
                  }
                }
                var result = buildSupportedWall(getRandomInt(0, lengthMyWalls), getRandomInt(0, 4), getRandom(-1, 1));
                if (result) {
                  counterWalls -= 1;
                }
            }
        }

        //build cannons
        for (var i = 0; counterCannons > 0; i++) {
          var x = getRandom(0, 0.4*ww);
          if (enemy.side == 2) {
            x = ww-x;
          }
          if (buildCannon(x, enemy.side)) {
            counterCannons--;
          }
        }

      }

      function buildCannon(posX, side) {
        var cannonHeight = 0.1*hh;
        var heightWall = 0.15*hh;
        if (side == 1) {
          imgurl = "img/cannonL0.png";
        } else if (side == 2) {
          imgurl = "img/cannonR0.png";
        }
        for (var i = 0; i < 5; i++) {
          var cannon = {
            tag: "cannon",
            temporary: 1,
            coordinate: {
              x: posX,
              y: hh-0.15*hh-cannonHeight/2-i*heightWall
            },
            size: {
              w: 0.1*ww,
              h: 0.1*hh
            },
            url: imgurl,
            // wheelUrl: "img/items/cannon1_default.png",
            wheelUrl: imgobjitemcannon1,
            // barrelUrl: "img/items/cannon2_default.png",
            barrelUrl: imgobjitemcannon2,
            angle: 0,
            color: "#cc0000"
          };
          if (cannonIsCorrect(cannon)) {
            cannon.temporary = 3;
            obj.push(cannon);
            return true
            break;
          }
        }
        return false
      }

      function buildSupportedWall(idWall, sideWall, deviation) {
        var coorX = 0;
        var coorY = 0;
        for (var i in obj) {
          if (obj[i]) {
            if (obj[i].tag == "floor" && ( (obj[i].coordinate.x < 0.5*ww && enemy.side == 1) || (obj[i].coordinate.x > 0.5*ww && enemy.side == 2) ) && i == idWall ) {
              switch (sideWall) {
                case 0:
                  coorX = obj[i].coordinate.x-obj[i].size.w/2-(0.05*ww)/2;
                  coorY = obj[i].coordinate.y;
                  coorX += deviation*(0.05*ww)/2;
                  break;
                case 1:
                  coorX = obj[i].coordinate.x;
                  coorY = obj[i].coordinate.y-obj[i].size.h/2-(0.1*hh)/2;
                  coorY += deviation*(0.1*hh)/2;
                  break;
                case 2:
                  coorX = obj[i].coordinate.x+obj[i].size.w/2+(0.05*ww)/2;
                  coorY = obj[i].coordinate.y;
                  coorX += deviation*(0.05*ww)/2;
                  break;
                case 3:
                  coorX = obj[i].coordinate.x;
                  coorY = obj[i].coordinate.y+obj[i].size.h/2+(0.1*hh)/2;
                  coorY += deviation*(0.1*hh)/2;
                  break;
              }
            }
          }
        }
        var heightWall = 0.15*hh;
        if (coorY > hh-0.15*hh-heightWall/2-4*heightWall && coorY < hh-0.15*hh-heightWall/2 && ( (enemy.side == 1 && coorY > 0 && coorY < 0.4*ww) || (enemy.side == 2 && coorY > 0.6*ww && coorY < ww) )) {
          var urlWall = me.textures.wall;
          if ( (me.side == 1 && coorX > ww/2) || (me.side == 2 && coorX < ww/2) ) {
            urlWall = enemy.textures.wall;
          }
          var wall = {
            tag: "floor",
            temporary: 1,
            coordinate: {
              x: coorX,
              y: coorY
            },
            size: {
              w: 0.075*ww,
              h: heightWall
            },
            deg: 0,
            //url: "img/wall.png",
            url: urlWall,
            color: "#cc0000"
          };
          var returnWall = wallIsCorrect(wall);
          if (returnWall.temporary == 2) {
            returnWall.temporary = 3;
            //returnWall.url = "img/wall.png";this comment
            returnWall.url = urlWall;
            obj.push(returnWall);
            return true
          } else if (returnWall.temporary == 1) {
            return false
          }
        } else {
          return false
        }
      }

      function buildColumnWalls(x, h) {
        for (var i = 0; i < h; i++) {
          var heightWall = 0.15*hh;
          var y = (hh-0.15*hh-heightWall/2)-i*(0.1*hh);
          var urlWall = me.textures.wall;
          if ( (me.side == 1 && x > ww/2) || (me.side == 2 && x < ww/2) ) {
            urlWall = enemy.textures.wall;
          }
          var wall = {
            tag: "floor",
            temporary: 1,
            coordinate: {
              x: x,
              y: y
            },
            size: {
              w: 0.075*ww,
              h: heightWall
            },
            deg: 0,
            //url: "img/wall.png",
            url: urlWall,
            color: "#cc0000"
          };
          //console.log(wallIsCorrect(wall, true));
          //var answerWall = wallIsCorrect(wall);
          var returnWall = wallIsCorrect(wall);
          if (returnWall.temporary == 2) {
            returnWall.temporary = 3;
            //returnWall.url = "img/wall.png";this comment
            returnWall.url = urlWall;
            obj.push(returnWall);
            //console.log("okay "+i);
          } else if (returnWall.temporary == 1) {
            //console.log("fail "+i);
            return i
          }
        }
        return h;
      }

      var downPressContact = false;
      $(document).mousedown(function (e){
      	if (!$("#contentContactForm").is(e.target) && $("#contentContactForm").has(e.target).length === 0) {
      		downPressContact = true;
      	} else {
      		downPressContact = false;
      	}
      });
      $(document).mouseup(function (e){
      	if (!$("#contentContactForm").is(e.target) && $("#contentContactForm").has(e.target).length === 0 && downPressContact) {
      		hideContactForm();
      	} else {
      		downPressContact = false;
      	}
      });
      function showContactForm() {
        $("#backContactForm").css("display", "flex");
      }
      function hideContactForm() {
        $("#backContactForm").css("display", "none");
      }

      function refreshContactStroke(el) {
        if ($(el).val() == "other") {
          $("#inputTypeNameContact").show();

          $("#inputNameContact").attr("placeholder", "enter your id contact");
        } else if ($(el).val() != "other") {
          $("#inputTypeNameContact").hide();

          $("#inputNameContact").attr("placeholder", "enter your "+$(el).val());
        }
      }

      function submitContactForm() {
        //var recaptcha = $("#g-recaptcha-response").val();
        var recaptcha = grecaptcha.getResponse(widgetRecaptcha1);

        $.ajax({
      		url: "https://gaidadei.ru/gmer.io/post",// https://gaidadei.ru/postnodejs/
      		method: "POST",
      		data: {
            typeContact: $("#selectTypeContact").val(),
            typeContactName: $("#inputTypeNameContact").val(),
            idContact: $("#inputNameContact").val(),
            theme: $("#selectTypeTheme").val(),
            message: $("#messageContact").val(),
      			recaptcha: recaptcha
      		},
      		success: function(answer) {
            answer = answer.split(":");
            if (answer[0] == "ok") {
              $("#messageAnswer").css("color", "#04a711");
              $(".strokeForm").hide();
            } else if (answer[0] == "err") {
              $("#messageAnswer").css("color", "#ff5656");
              $(".strokeForm").show();
            }
            $("#messageAnswer").html(answer[1]);
            $("#messageAnswer").show();
      		}
      	});
      }
      // var onloadCallback = function() {
      //   grecaptcha.render('recaptcha', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
      // };

      var widgetRecaptcha1;
      var widgetRecaptcha2;
      var onloadCallback = function() {
        widgetRecaptcha1 = grecaptcha.render('recaptcha1', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
        widgetRecaptcha2 = grecaptcha.render('recaptcha2', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
      };

      function showAllDetails() {
        $("#buttonShowAllFD").hide();
        $("#wrapTableInFG").css("max-height", "600px");
      }

      var downPressSign = false;
      $(document).mousedown(function (e){
      	if (!$("#contentSign").is(e.target) && $("#contentSign").has(e.target).length === 0) {
      		downPressSign = true;
      	} else {
      		downPressSign = false;
      	}
      });
      $(document).mouseup(function (e){
      	if (!$("#contentSign").is(e.target) && $("#contentSign").has(e.target).length === 0 && downPressSign) {
      		hideSign();
      	} else {
      		downPressSign = false;
      	}
      });
      function showSign() {
        $("#backSign").css("display", "flex");
      }
      function hideSign() {
        $("#backSign").css("display", "none");

        $("#wrapSignSendEmail").show();
        $("#wrapSignAnswerEmail1").hide();
        $("#wrapSignAnswerEmail2").hide();

        removeCookie("error");
      }

      function sendSignEmail() {
          $("#wrapSignSendEmail").css("display", "none");

          var email = $("#inputEmailSign").val();

          if (emailValidate(email)) {
            socket.emit('getEmail', email);
          } else {
            errorRegister("Email is incorrect");
          }
      }

      function getKey(length) {
        var letters = "QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890-+";
        var answer = "";
        for (var i = 0; i < length; i++) {
          answer += letters[getRandomInt(0, 64)];
        }
        return answer;
      }

      function clickAnswer1() {
        var recaptcha = grecaptcha.getResponse(widgetRecaptcha2);

        var action = $("#submitSignAnswer1").attr("act");
        var mail = $("#submitSignAnswer1").attr("mail");

        var link = "https://gmer.io/g/cannons/request";
  			var key = getKey(20);

  			link += "?";
  			link += "type="+action;
  			link += "&";
  			link += "mail="+mail;
  			link += "&";
  			link += "key="+key;

        socket.emit('addQuery', link);
        socket.on('addedQuery', function() {
          $.ajax({
        		url: "https://gaidadei.ru/gmer.io/signinup",
        		method: "POST",
        		data: {
              action: action,
              mail: mail,
              url: link,
        			recaptcha: recaptcha
        		},
        		success: function(answer) {
              var ans = answer.split(":");

              $("#wrapSignAnswerEmail1").hide();

              if (ans[0] == "ok") {
                $("#textSignAnswer2").css("color", "#3bb333");
              } else if (ans[0] == "err") {
                $("#textSignAnswer2").css("color", "#ff5252");
              }

              $("#textSignAnswer2").html(ans[1]);
              $("#wrapSignAnswerEmail2").show();
        		}
        	});
        });

        //answer
        // $("#wrapSignAnswerEmail1").hide();
        //
        // if (success) {
        //   $("#textSignAnswer2").css("color", "#3bb333");
        // } else if (!success) {
        //   $("#textSignAnswer2").css("color", "#ff5252");
        // }
        //
        // $("#textSignAnswer2").html(text);
        // $("#wrapSignAnswerEmail2").show();

        // var action = $("#submitSignAnswer1").attr("act");
        // var mail = $("#submitSignAnswer1").attr("mail");
        // if (action == "signup") {
        //   socket.emit('sendMail', "signup", mail);
        // } else if (action == "signin") {
        //   socket.emit('sendMail', "signin", mail);
        // }
      }

      function emailValidate(mail) {
        var exp = /^\w+@\w+\.\w+$/;
        return exp.test(mail);
      }

      function errorRegister(text) {
        $("#wrapSignSendEmail").css("display", "block");
        $("#textSign").hide();
        $("#noticeError").html(text);
        $("#noticeError").show();
      }

      var downPressConfirmExit = false;
      $(document).mousedown(function (e){
        if (!$("#confirmExit").is(e.target) && $("#confirmExit").has(e.target).length === 0) {
          downPressConfirmExit = true;
        } else {
          downPressConfirmExit = false;
        }
      });
      $(document).mouseup(function (e){
        if (!$("#confirmExit").is(e.target) && $("#confirmExit").has(e.target).length === 0 && downPressConfirmExit) {
          hideConfirmExit();
        } else {
          downPressConfirmExit = false;
        }
      });

      function showConfirmExit() {
        $("#confirmExit").show();

        $("#confirmExit").css("right", "20px");
        $("#confirmExit").css("top", $("#wrapProfileButton").offset().top+$("#wrapProfileButton").height()+20+"px");
      }

      function hideConfirmExit() {
        $("#confirmExit").hide();

        $("#confirmExit").css("right", "0px");
        $("#confirmExit").css("top", "0px");
      }

      function exitAccount() {
        hideConfirmExit();
        removeCookie("mid");
        $(location).attr("href", "/");
      }

      var animateMenu, animateGame;

      $("#canvas").attr("width", ww+"px");
      $("#canvas").attr("height", hh+ "px");

      function setGuiMenu() {
        $("#gui").remove();
        $("#guiFinishGame").remove();
        $("body").append("<div id='gui'></div>");
        $("#gui").css("position", "absolute");

        $("#gui").append("<div id='wrapProfileButton'></div>");
        $("#wrapProfileButton").css("display", "none");
        $("#wrapProfileButton").css("position", "fixed");
        $("#wrapProfileButton").css("top", "20px");
        $("#wrapProfileButton").css("right", "20px");
        $("#wrapProfileButton").css("flex-direction", "row");
        $("#wrapProfileButton").css("align-items", "stretch");
        $("#wrapProfileButton").css("justify-content", "space-around");

        $("#wrapProfileButton").append("<a id='profileButton'>Profile</a>");
        $("#profileButton").css("padding", "20px");
        $("#profileButton").css("background-color", "#ce0000");
        $("#profileButton").css("color", "#fff");
        $("#profileButton").css("font", "14px Arial");
        $("#profileButton").css("text-align", "center");
        $("#profileButton").css("text-decoration", "none");
        $("#profileButton").css("cursor", "pointer");
        $("#profileButton").css("border-radius", "5px 0px 0px 5px");
        $("#profileButton").css("transition", "opacity linear 1s");
        $("#profileButton").css("-moz-transition", "opacity linear 1s");
        $("#profileButton").css("-o-transition", "opacity linear 1s");
        $("#profileButton").css("-webkit-transition", "opacity linear 1s");

        $("#wrapProfileButton").append("<div id='profileTurnOFFButton'></div>");
        $("#profileTurnOFFButton").attr("onclick", "showConfirmExit()");
        $("#profileTurnOFFButton").css("background-color", "#9c0000");
        //$("#profileTurnOFFButton").css("background-image", "url('img/exitAccount.png')");
        $("#profileTurnOFFButton").css("background-image", "url('"+allTextures.exitAccount+"')");
        $("#profileTurnOFFButton").css("background-position", "center");
        $("#profileTurnOFFButton").css("background-size", "30px");
        $("#profileTurnOFFButton").css("background-repeat", "no-repeat");
        $("#profileTurnOFFButton").css("width", "50px");
        $("#profileTurnOFFButton").css("color", "#fff");
        $("#profileTurnOFFButton").css("font", "14px Arial");
        $("#profileTurnOFFButton").css("text-align", "center");
        $("#profileTurnOFFButton").css("cursor", "pointer");
        $("#profileTurnOFFButton").css("border-radius", "0px 5px 5px 0px");
        $("#profileTurnOFFButton").css("transition", "opacity linear 1s");
        $("#profileTurnOFFButton").css("-moz-transition", "opacity linear 1s");
        $("#profileTurnOFFButton").css("-o-transition", "opacity linear 1s");
        $("#profileTurnOFFButton").css("-webkit-transition", "opacity linear 1s");

        $("#gui").append("<div id='confirmExit'></div>");
        $("#confirmExit").css("display", "flex");
        $("#confirmExit").css("position", "fixed");
        $("#confirmExit").css("flex-direction", "column");
        $("#confirmExit").css("align-items", "stretch");
        $("#confirmExit").css("justify-content", "flex-start");
        $("#confirmExit").css("background-color", "#9c0000");
        $("#confirmExit").css("border-radius", "5px");
        $("#confirmExit").css("box-shadow", "0px 0px 5px #00000033");

        $("#confirmExit").append("<div id='arrowConfirmExit'></div>");
        $("#arrowConfirmExit").css("position", "absolute");
        $("#arrowConfirmExit").css("float", "right");
        $("#arrowConfirmExit").css("width", "20px");
        $("#arrowConfirmExit").css("height", "20px");
        $("#arrowConfirmExit").css("background-color", "#9c0000");
        $("#arrowConfirmExit").css("transform", "rotate(45deg)");
        $("#arrowConfirmExit").css("align-self", "flex-end");
        $("#arrowConfirmExit").css("z-index", "-1");
        $("#arrowConfirmExit").css("margin-top", "-5px");
        $("#arrowConfirmExit").css("margin-left", "-15px");

        $("#confirmExit").hide();

        $("#confirmExit").append("<div id='textConfirmExit'>Do you wanna exit this account?</div>");
        $("#textConfirmExit").css("color", "#fff");
        $("#textConfirmExit").css("font-family", "Arial");
        $("#textConfirmExit").css("font-size", "14px");
        $("#textConfirmExit").css("margin", "10px");

        $("#confirmExit").append("<div id='wrapButtonsConfirmExit'></div>");
        $("#wrapButtonsConfirmExit").css("display", "flex");
        $("#wrapButtonsConfirmExit").css("flex-direction", "row");
        $("#wrapButtonsConfirmExit").css("align-items", "center");
        $("#wrapButtonsConfirmExit").css("justify-content", "space-around");
        $("#wrapButtonsConfirmExit").css("margin", "10px");

        $("#wrapButtonsConfirmExit").append("<div id='buttonConfirmExitYes'>Yes</div>");
        $("#buttonConfirmExitYes").attr("onclick", "exitAccount()");
        $("#buttonConfirmExitYes").css("color", "#fff");
        $("#buttonConfirmExitYes").css("font-family", "Arial");
        $("#buttonConfirmExitYes").css("font-size", "12px");
        $("#buttonConfirmExitYes").css("cursor", "pointer");
        $("#buttonConfirmExitYes").css("background-color", "#ffffff");
        $("#buttonConfirmExitYes").css("border-radius", "5px");
        $("#buttonConfirmExitYes").css("padding", "5px 10px");
        $("#buttonConfirmExitYes").css("color", "#9c0000");

        $("#wrapButtonsConfirmExit").append("<div id='buttonConfirmExitNo'>No</div>");
        $("#buttonConfirmExitNo").attr("onclick", "hideConfirmExit()");
        $("#buttonConfirmExitNo").css("color", "#fff");
        $("#buttonConfirmExitNo").css("font-family", "Arial");
        $("#buttonConfirmExitNo").css("font-size", "14px");
        $("#buttonConfirmExitNo").css("cursor", "pointer");
        $("#buttonConfirmExitNo").css("border-radius", "5px");
        $("#buttonConfirmExitNo").css("padding", "5px 10px");

        $("#gui").append("<div id='signButton'>Sign in/up</div>");
        $("#signButton").css("display", "none");
        $("#signButton").css("flex-direction", "column");
        $("#signButton").attr("onclick", "showSign()");
        $("#signButton").css("position", "fixed");
        $("#signButton").css("top", "20px");
        $("#signButton").css("right", "20px");
        $("#signButton").css("padding", "20px");
        $("#signButton").css("background-color", "#9c0000");
        $("#signButton").css("color", "#fff");
        $("#signButton").css("font", "14px Arial");
        $("#signButton").css("text-align", "center");
        $("#signButton").css("cursor", "pointer");
        $("#signButton").css("border-radius", "5px");
        $("#signButton").css("transition", "opacity linear 1s");
        $("#signButton").css("-moz-transition", "opacity linear 1s");
        $("#signButton").css("-o-transition", "opacity linear 1s");
        $("#signButton").css("-webkit-transition", "opacity linear 1s");

        $("#gui").append("<div id='searchGame'>Search game</div>");
        $("#searchGame").attr("onclick", "switchSearch()");
        $("#searchGame").css("position", "fixed");
        $("#searchGame").css("top", "50%");
        $("#searchGame").css("right", "20px");
        $("#searchGame").css("margin-top", "-40px");
        $("#searchGame").css("width", "150px");
        $("#searchGame").css("padding", "20px");
        $("#searchGame").css("border-radius", "5px");
        $("#searchGame").css("background-color", "#005fc3");
        $("#searchGame").css("color", "#fff");
        $("#searchGame").css("font", "16px Arial");
        $("#searchGame").css("text-align", "center");
        $("#searchGame").css("cursor", "pointer");
        $("#searchGame").css("transition", "opacity linear 1s");
        $("#searchGame").css("-moz-transition", "opacity linear 1s");
        $("#searchGame").css("-o-transition", "opacity linear 1s");
        $("#searchGame").css("-webkit-transition", "opacity linear 1s");

        $("#gui").append("<input id='inputName' />");
        $("#inputName").attr("type", "text");
        $("#inputName").attr("placeholder", "Your name");
        $("#inputName").css("position", "fixed");
        $("#inputName").css("top", "50%");
        $("#inputName").css("right", "20px");
        $("#inputName").css("margin-top", "40px");
        $("#inputName").css("width", "150px");
        $("#inputName").css("padding", "20px");
        $("#inputName").css("font", "14px Arial");
        $("#inputName").css("background-color", "#fff");
        $("#inputName").css("text-align", "center");
        $("#inputName").css("outline", "none");
        $("#inputName").css("border", "none");
        $("#inputName").css("border-radius", "5px");
        $("#inputName").css("color", "#333");

        $("#gui").append("<div id='fullscreenButton'>Use full screen for phone. This is comfortable</div>");
        var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
        $("#fullscreenButton").hide();
        if (isphone && !document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
          $("#fullscreenButton").show();
        }
        $("#fullscreenButton").attr("onclick", "makefullscreen()");
        $("#fullscreenButton").css("border", "3px dashed #fff");
        $("#fullscreenButton").css("position", "fixed");
        $("#fullscreenButton").css("top", "20px");
        $("#fullscreenButton").css("left", "20px");
        $("#fullscreenButton").css("width", "80px");
        $("#fullscreenButton").css("text-align", "center");
        $("#fullscreenButton").css("font-family", "Arial");
        $("#fullscreenButton").css("font-size", "10px");
        $("#fullscreenButton").css("font-weight", "bold");
        $("#fullscreenButton").css("color", "#fff");
        $("#fullscreenButton").css("padding", "10px");
        $("#fullscreenButton").css("cursor", "pointer");

        $("#gui").append("<div id='contactButton'>Contact with us</div>");
        $("#contactButton").attr("onclick", "showContactForm()");
        $("#contactButton").css("position", "fixed");
        $("#contactButton").css("right", "20px");
        $("#contactButton").css("bottom", "10px");
        $("#contactButton").css("padding", "5px");
        $("#contactButton").css("cursor", "pointer");
        $("#contactButton").css("font-size", "12px");
        $("#contactButton").css("font-family", "Arial");
        $("#contactButton").css("color", "#fff");
        $("#contactButton").css("background-color", "#00000077");

        $("#gui").append("<div id='backContactForm'></div>");
        $("#backContactForm").css("position", "fixed");
        $("#backContactForm").css("left", "0px");
        $("#backContactForm").css("top", "0px");
        $("#backContactForm").css("width", "100%");
        $("#backContactForm").css("height", "100%");
        $("#backContactForm").css("display", "none");
        $("#backContactForm").css("flex-direction", "column");
        $("#backContactForm").css("align-items", "center");
        $("#backContactForm").css("justify-content", "center");
        $("#backContactForm").css("background-color", "#00000099");

        $("#backContactForm").append("<div id='contentContactForm'></div>");
        $("#contentContactForm").css("background-color", "#fff");
        $("#contentContactForm").css("width", "100%");
        $("#contentContactForm").css("max-width", "600px");

        $("#contentContactForm").append("<div id='messageAnswer'></div>");
        $("#messageAnswer").css("margin", "20px");
        $("#messageAnswer").css("text-align", "center");
        $("#messageAnswer").css("font-size", "14px");
        $("#messageAnswer").css("font-family", "Arial");
        $("#messageAnswer").hide();

        $("#contentContactForm").append("<div class='strokeForm' id='strokeIdContact'></div>");

        $("#strokeIdContact").append("<select class='inputStyle' id='selectTypeContact'><option value='email'>e-mail</option><option value='snapchat'>snapchat</option><option value='telegram'>telegram</option><option value='other'>other</option></select>");
        $("#selectTypeContact").attr("onclick", "refreshContactStroke(this)");

        $("#strokeIdContact").append("<input class='inputStyle' type='text' id='inputTypeNameContact' placeholder='enter what it is' />");
        $("#inputTypeNameContact").hide();

        $("#strokeIdContact").append("<input class='inputStyle' type='text' id='inputNameContact' placeholder='enter your e-mail' />");

        $("#contentContactForm").append("<div class='strokeForm' id='strokeThemeContact'></div>");

        $("#strokeThemeContact").append("<select class='inputStyle' id='selectTypeTheme'><option value='commercial'>commercial issues</option><option value='technical'>technical problems</option><option value='idea'>i have the great idea</option><option value='other'>other</option></select>");

        $("#contentContactForm").append("<div class='strokeForm' id='strokeTextarea'></div>");

        $("#strokeTextarea").append("<textarea class='inputStyle' id='messageContact' placeholder='enter your message'></textarea>");

        $("#contentContactForm").append("<div class='strokeForm' id='strokeSubmit'></div>");

        //recaptcha
        //$("#strokeSubmit").append("<div id='recaptcha'></div>");
        $("#strokeSubmit").append("<div id='recaptcha1'></div>");

        $("#strokeSubmit").append("<div id='submitContactForm'>Submit</div>");
        $("#submitContactForm").attr("onclick", "submitContactForm()");
        $("#submitContactForm").css("padding", "15px 40px");
        $("#submitContactForm").css("background-color", "#333");
        $("#submitContactForm").css("font-size", "14px");
        $("#submitContactForm").css("font-family", "Arial");
        $("#submitContactForm").css("color", "#fff");
        $("#submitContactForm").css("cursor", "pointer");
        $("#submitContactForm").css("margin", "0px 20px");
        $("#submitContactForm").css("display", "flex");
        $("#submitContactForm").css("flex-direction", "column");
        $("#submitContactForm").css("justify-content", "center");
        $("#submitContactForm").css("align-items", "center");

        $("textarea.inputStyle").css("resize", "none");
        $("textarea.inputStyle").css("height", "100px");

        $("#strokeSubmit").css("justify-content", "flex-end");
        $("#strokeSubmit").css("align-items", "stretch");
        $("#strokeSubmit").css("margin", "20px 0px");

        $("#gui").append("<div id='backSign'></div>");
        $("#backSign").css("position", "fixed");
        $("#backSign").css("left", "0px");
        $("#backSign").css("top", "0px");
        $("#backSign").css("width", "100%");
        $("#backSign").css("height", "100%");
        $("#backSign").css("display", "none");
        $("#backSign").css("flex-direction", "column");
        $("#backSign").css("align-items", "center");
        $("#backSign").css("justify-content", "center");
        $("#backSign").css("background-color", "#00000099");

        $("#backSign").append("<div id='contentSign'></div>");
        $("#contentSign").css("background-color", "#fff");
        $("#contentSign").css("width", "100%");
        $("#contentSign").css("max-width", "400px");
        $("#contentSign").css("display", "flex");
        $("#contentSign").css("flex-direction", "column");
        $("#contentSign").css("align-items", "center");
        $("#contentSign").css("justify-content", "space-around");

        $("#contentSign").append("<div id='wrapSignSendEmail'></div>");

        $("#wrapSignSendEmail").append("<div id='textSign'>Sign in or sing up</div>");
        $("#textSign").css("margin", "20px");
        $("#textSign").css("text-align", "center");
        $("#textSign").css("font-size", "14px");
        $("#textSign").css("font-family", "Arial");
        $("#textSign").css("color", "#333");

        $("#wrapSignSendEmail").append("<p id='noticeError'></p>");
        $("#noticeError").hide();
        $("#noticeError").css("margin", "20px");
        $("#noticeError").css("text-align", "center");
        $("#noticeError").css("font-size", "14px");
        $("#noticeError").css("font-family", "Arial");
        $("#noticeError").css("color", "#ff0000");

        $("#wrapSignSendEmail").append("<input class='inputStyle' id='inputEmailSign' type='text' placeholder='enter your email' />");
        $("#inputEmailSign").css("text-align", "center");

        $("#wrapSignSendEmail").append("<div id='submitEmailSign'>next</div>");
        $("#submitEmailSign").attr("onclick", "sendSignEmail()");
        $("#submitEmailSign").css("margin", "20px");
        $("#submitEmailSign").css("padding", "10px 20px");
        $("#submitEmailSign").css("background-color", "#9c0000");
        $("#submitEmailSign").css("text-align", "center");
        $("#submitEmailSign").css("border-radius", "5px");
        $("#submitEmailSign").css("font-size", "14px");
        $("#submitEmailSign").css("font-family", "Arial");
        $("#submitEmailSign").css("color", "#fff");
        $("#submitEmailSign").css("cursor", "pointer");

        $("#contentSign").append("<div id='wrapSignAnswerEmail'></div>");

        $("#wrapSignAnswerEmail").append("<div id='wrapSignAnswerEmail1'></div>");
        $("#wrapSignAnswerEmail1").hide();

        $("#wrapSignAnswerEmail1").append("<div id='textSignAnswer1'></div>");
        $("#textSignAnswer1").css("margin", "20px");
        $("#textSignAnswer1").css("text-align", "center");
        $("#textSignAnswer1").css("font-size", "14px");
        $("#textSignAnswer1").css("font-family", "Arial");
        $("#textSignAnswer1").css("color", "#333");

        $("#wrapSignAnswerEmail1").append("<div id='recaptcha2'></div>");

        $("#wrapSignAnswerEmail1").append("<div id='submitSignAnswer1'></div>");
        $("#submitSignAnswer1").attr("onclick", "clickAnswer1()");
        $("#submitSignAnswer1").css("margin", "20px");
        $("#submitSignAnswer1").css("padding", "10px 20px");
        $("#submitSignAnswer1").css("background-color", "#9c0000");
        $("#submitSignAnswer1").css("text-align", "center");
        $("#submitSignAnswer1").css("border-radius", "5px");
        $("#submitSignAnswer1").css("font-size", "14px");
        $("#submitSignAnswer1").css("font-family", "Arial");
        $("#submitSignAnswer1").css("color", "#fff");
        $("#submitSignAnswer1").css("cursor", "pointer");

        $("#wrapSignAnswerEmail").append("<div id='wrapSignAnswerEmail2'></div>");
        $("#wrapSignAnswerEmail2").hide();

        $("#wrapSignAnswerEmail2").append("<div id='textSignAnswer2'></div>");
        $("#textSignAnswer2").css("margin", "20px");
        $("#textSignAnswer2").css("text-align", "center");
        $("#textSignAnswer2").css("font-size", "14px");
        $("#textSignAnswer2").css("font-family", "Arial");
        $("#textSignAnswer2").css("color", "#333");

        $("#gui").append("<div id='wrapCookieAcceptance'></div>");
        $("#wrapCookieAcceptance").css("position", "fixed");
        $("#wrapCookieAcceptance").css("left", "0px");
        $("#wrapCookieAcceptance").css("bottom", "0px");
        $("#wrapCookieAcceptance").css("max-width", "30%");
        $("#wrapCookieAcceptance").css("background-color", "#fff");
        $("#wrapCookieAcceptance").css("border-radius", "5px 5px 0px 0px");
        $("#wrapCookieAcceptance").css("-moz-border-radius", "5px 5px 0px 0px");
        $("#wrapCookieAcceptance").css("-webkit-border-radius", "5px 5px 0px 0px");
        $("#wrapCookieAcceptance").css("-o-border-radius", "5px 5px 0px 0px");
        $("#wrapCookieAcceptance").css("font-family", "Arial");
        $("#wrapCookieAcceptance").css("font-size", "min(14px, 4vw)");
        $("#wrapCookieAcceptance").css("display", "flex");
        $("#wrapCookieAcceptance").css("flex-direction", "column");
        $("#wrapCookieAcceptance").css("align-items", "flex-start");
        $("#wrapCookieAcceptance").css("justify-content", "space-around");

        $("#wrapCookieAcceptance").append("<p id='textCA'>We are using cookie for correct work site and game.</p>");
        $("#textCA").css("margin", "20px");
        $("#textCA").css("color", "#999");

        $("#wrapCookieAcceptance").append("<div id='buttonCA'>Accept</div>");
        $("#buttonCA").attr("onclick", "closeCA(true)");
        $("#buttonCA").css("margin", "20px");
        $("#buttonCA").css("margin-top", "0px");
        $("#buttonCA").css("background-color", "#5cbfc6");
        $("#buttonCA").css("color", "#fff");
        $("#buttonCA").css("padding", "10px");
        $("#buttonCA").css("border-radius", "5px");
        $("#buttonCA").css("-moz-border-radius", "5px");
        $("#buttonCA").css("-webkit-border-radius", "5px");
        $("#buttonCA").css("-o-border-radius", "5px");
        $("#buttonCA").css("cursor", "pointer");

        //styles classes
        $(".strokeForm").css("display", "flex");
        $(".strokeForm").css("flex-direction", "row");
        $(".strokeForm").css("align-items", "center");
        $(".strokeForm").css("justify-content", "space-around");

        $(".inputStyle").css("margin", "10px");
        $(".inputStyle").css("flex", "1");
        $(".inputStyle").css("font-family", "Arial");
        $(".inputStyle").css("font-size", "14px");
        $(".inputStyle").css("padding", "10px 15px");
        $(".inputStyle").css("border", "2px solid #fff");
        $(".inputStyle").css("outline", "none");
        $(".inputStyle").css("color", "#333");
        $(".inputStyle").css("background-color", "#fff");
        $(".inputStyle").css("border-bottom", "1px solid #ddd");

        //this place
        // onloadCallback = function() {
        //   widgetRecaptcha1 = grecaptcha.render('recaptcha1', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
        //   widgetRecaptcha2 = grecaptcha.render('recaptcha2', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
        // };
        if (onloadCallback) {
        widgetRecaptcha1 = grecaptcha.render('recaptcha1', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
        widgetRecaptcha2 = grecaptcha.render('recaptcha2', { 'sitekey': '6Ld-_NEUAAAAAIcro-nuBeDeMigbdDBoxVt6jw9h' });
        }
      }

      function setGui() {
        $("#gui").remove();
        $("body").append("<div id='gui'></div>");
        $("#gui").css("position", "absolute");

        $("#gui").append("<div id='fullscreenButton'>Full screen</div>");
        var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
        $("#fullscreenButton").hide();
        if (isphone && !document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
          $("#fullscreenButton").show();
        }
        $("#fullscreenButton").attr("onclick", "makefullscreen()");
        $("#fullscreenButton").css("border", "3px dashed #10606f");
        $("#fullscreenButton").css("position", "fixed");
        $("#fullscreenButton").css("bottom", "5px");
        $("#fullscreenButton").css("left", "50%");
        $("#fullscreenButton").css("width", "100px");
        $("#fullscreenButton").css("margin-left", "-53px");
        $("#fullscreenButton").css("text-align", "center");
        $("#fullscreenButton").css("font-family", "Arial");
        $("#fullscreenButton").css("font-size", "10px");
        $("#fullscreenButton").css("font-weight", "bold");
        $("#fullscreenButton").css("color", "#10606f");
        $("#fullscreenButton").css("padding", "5px 0px");
        $("#fullscreenButton").css("cursor", "pointer");
      }

      function drawMenu() {
        var cvs = document.getElementById("canvas");
    		var ctx = cvs.getContext("2d");
        ctx.clearRect(0, 0, ww, hh);
        $("body").css("width", $(window).width()+"px");
        $("body").css("height", $(window).height()+"px");
        $("#canvas").css("width", $(window).width()+"px");
        $("#canvas").css("height", $(window).height()+"px");

        //$("#canvas").css("background-image", "url("+backgroundUrl+")");

        //draw floors
        ctx.save();
        ctx.beginPath();
        ctx.translate(0.2*ww, 0.9*hh);
        ctx.rotate(0);
        ctx.globalCompositeOperation = 'source-over';
        //var img = new Image();
        //img.src = "img/leftSummerGrass.png";
        //img.src = allTextures.leftSummerGrass;
        ctx.drawImage(imgobjleftSummerGrass, -0.4*ww/2, -0.1*hh/2, 0.4*ww, 0.1*hh);
        ctx.closePath();
        ctx.restore();

        //draw walls
        for (var i = 0; i < 5; i++) {
            ctx.save();
    				ctx.beginPath();
    				ctx.translate(0.05*ww, (0.75*hh)-(0.1*hh*i));
            ctx.rotate(0);
            ctx.globalCompositeOperation = 'source-over';
            //var img = new Image();
            //img.src = "img/wall.png";
            //img.src = "img/items/wall_default.png";
            //img.src = allTextures.itemwall;
            ctx.drawImage(imgobjitemwall, 0, 0, 0.05*ww, 0.1*hh);
    				ctx.restore();
        }
        //draw walls
        for (var i = 0; i < 3; i++) {
            ctx.save();
    				ctx.beginPath();
    				ctx.translate(0.1*ww, (0.75*hh)-(0.2*hh*i));
            ctx.rotate(0);
            ctx.globalCompositeOperation = 'source-over';
            //var img = new Image();
            //img.src = "img/wall.png";
            //img.src = "img/items/wall_default.png";
            //img.src = allTextures.itemwall;
            ctx.drawImage(imgobjitemwall, 0, 0, 0.05*ww, 0.1*hh);
    				ctx.restore();
        }

        //draw cannons
        for (var i = 0; i < 3; i++) {
            ctx.save();
    				ctx.beginPath();
    				ctx.translate(0.1125*ww, (0.72*hh)-(0.2*hh*i));
            ctx.rotate(0);
            ctx.globalCompositeOperation = 'source-over';
            // var img = new Image();
            // img.src = "img/cannonL0.png";
            // ctx.drawImage(img, 0, 0, 0.03*ww, 0.03*hh);
            //var img = new Image();
            //img.src = "img/items/cannon2_default.png";
            //img.src = allTextures.itemcannon2;
            ctx.drawImage(imgobjitemcannon2, 0, 0, 0.03*ww, 0.03*hh);
            //var img = new Image();
            //img.src = "img/items/cannon1_default.png";
            //img.src = allTextures.itemcannon1;
            ctx.drawImage(imgobjitemcannon1, 0, 0, 0.03*ww, 0.03*hh);
            ctx.closePath();
    				ctx.restore();
        }
        ctx.save();
        ctx.beginPath();
        ctx.translate(0.06255*ww, (0.72*hh)-(0.2*hh*2));
        ctx.rotate(0);
        ctx.globalCompositeOperation = 'source-over';
        // var img = new Image();
        // img.src = "img/cannonL0.png";
        // ctx.drawImage(img, 0, 0, 0.03*ww, 0.03*hh);
        //var img = new Image();
        //img.src = "img/items/cannon2_default.png";
        //img.src = allTextures.itemcannon2;
        ctx.drawImage(imgobjitemcannon2, 0, 0, 0.03*ww, 0.03*hh);
        //var img = new Image();
        //img.src = "img/items/cannon1_default.png";
        //img.src = allTextures.itemcannon1;
        ctx.drawImage(imgobjitemcannon1, 0, 0, 0.03*ww, 0.03*hh);
        ctx.closePath();
        ctx.restore();

        ctx.save();
        ctx.beginPath();
        ctx.translate(0.3*ww, 0.82*hh);
        ctx.rotate(0);
        ctx.globalCompositeOperation = 'source-over';
        // var img = new Image();
        // img.src = "img/cannonL0.png";
        // ctx.drawImage(img, 0, 0, 0.03*ww, 0.03*hh);
        //var img = new Image();
        //img.src = "img/items/cannon2_default.png";
        //img.src = allTextures.itemcannon2;
        ctx.drawImage(imgobjitemcannon2, 0, 0, 0.03*ww, 0.03*hh);
        //var img = new Image();
        //img.src = "img/items/cannon1_default.png";
        //img.src = allTextures.itemcannon1;
        ctx.drawImage(imgobjitemcannon1, 0, 0, 0.03*ww, 0.03*hh);
        ctx.closePath();
        ctx.restore();

        //draw water
        ctx.save();
				ctx.beginPath();
				ctx.translate(0, 0.92*hh);
        //ar img = new Image();
        //img.src = "img/water.png";
        //img.src = allTextures.water;
        ctx.drawImage(imgobjwater, 0, 0, ww, 0.08*hh);
				ctx.restore();

        cancelAnimationFrame(animateGame);
        animateMenu = requestAnimationFrame(drawMenu);
      }

      function draw() {
        var cvs = document.getElementById("canvas");
    		var ctx = cvs.getContext("2d");
        ctx.clearRect(0, 0, ww, hh);
        $("body").css("width", $(window).width()+"px");
        $("body").css("height", $(window).height()+"px");
        $("#canvas").css("width", $(window).width()+"px");
        $("#canvas").css("height", $(window).height()+"px");

        //$("#canvas").css("background-image", "url("+backgroundUrl+")");

        //draw areas
        for (var i in obj) {

          if (obj[i].visible && obj[i].tag == "area") {
            if (obj[i].id == "buildArea") {
              var posX = obj[i].coordinate.x;
              if (me.side == 2) {
                posX = ww-posX;
              }

              ctx.save();
      				ctx.beginPath();
      				ctx.translate(posX, obj[i].coordinate.y);
              ctx.rotate(obj[i].deg);
              ctx.globalCompositeOperation = 'source-over';
              if (obj[i].url) {
                var img = new Image();
                img.src = obj[i].url;
                ctx.drawImage(img, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
              } else {
                ctx.rect(-obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
                ctx.fillStyle = obj[i].color;
                ctx.fill();
                ctx.strokeStyle = obj[i].colorStroke;
                ctx.strokeRect(-obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);

                var numCellx = Math.trunc(obj[i].size.w/150);
                var numCelly = Math.trunc(obj[i].size.w/150);

                for (var j = 0; j < numCellx*numCelly; j++) {
                  ctx.rect(-obj[i].size.w/2+(j%numCellx)*obj[i].size.w/numCellx, -obj[i].size.h/2+Math.trunc(j/numCellx)*obj[i].size.h/numCelly, obj[i].size.w/numCellx, obj[i].size.h/numCelly);
                  ctx.fillStyle = obj[i].color;
                  ctx.fill();
                  ctx.strokeStyle = obj[i].colorStroke;
                  ctx.strokeRect(-obj[i].size.w/2+(j%numCellx)*obj[i].size.w/numCellx, -obj[i].size.h/2+Math.trunc(j/numCellx)*obj[i].size.h/numCelly, obj[i].size.w/numCellx, obj[i].size.h/numCelly);
                }
              }
      				ctx.restore();

              ctx.save();
              ctx.beginPath();
              ctx.translate(posX, obj[i].coordinate.y);
              ctx.font = obj[i].size.font+"px Arial";
              ctx.fillStyle = obj[i].colorText;
              ctx.textAlign = "center";
              ctx.fillText(obj[i].title, 0, 0, obj[i].size.w);
              ctx.closePath();
              ctx.restore();
            }
          }
        }
        //draw floors
        for (var i in obj) {
          if (obj[i].tag == "floor") {
            ctx.save();
    				ctx.beginPath();
    				ctx.translate(obj[i].coordinate.x, obj[i].coordinate.y);
            ctx.rotate(obj[i].deg);
            ctx.globalCompositeOperation = 'source-over';

            if (obj[i].temporary && obj[i].temporary == "1") {
              ctx.globalAlpha = 0.5;
            }

            if (obj[i].url) {
              //var img = new Image();
              //img.src = obj[i].url;


              if (obj[i].temporary == "always") {
                ctx.drawImage(obj[i].url, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
              } else {
                if ((me.side == 1 && obj[i].coordinate.x < 0.5*ww) || (me.side == 2 && obj[i].coordinate.x > 0.5*ww)) {
                  ctx.drawImage(me.textures.wall, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
                } else if ((me.side == 1 && obj[i].coordinate.x > 0.5*ww) || (me.side == 2 && obj[i].coordinate.x < 0.5*ww)) {
                  ctx.drawImage(enemy.textures.wall, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
                }

              }
            } else {
              ctx.rect(-obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
              ctx.fillStyle = obj[i].color;
              ctx.fill();
            }
            ctx.closePath();
    				ctx.restore();
          }
        }
        //draw holes
        for (var i in obj) {
          if (obj[i].tag == "hole") {
            ctx.save();
      			ctx.beginPath();
      			ctx.translate(obj[i].coordinate.x, obj[i].coordinate.y);
            ctx.globalCompositeOperation = 'destination-out';
      			ctx.arc(0, 0, obj[i].r, 0, 2*Math.PI);
      			ctx.fillStyle = "#000";
      			ctx.fill();
      			ctx.restore();
          }
        }
        //draw explode
        for (var i in obj) {
          if (obj[i].tag == "explode") {
            ctx.save();
      			ctx.beginPath();
      			ctx.translate(obj[i].coordinate.x, obj[i].coordinate.y);
            ctx.globalCompositeOperation = 'source-over';
            // var img = new Image();
            // //img.src = "img/explode2.png";
            // img.src = allTextures.explode2;
            // if (obj[i].duration.current/obj[i].duration.all > 2/3) {
            //   //img.src = "img/explode3.png";
            //   img.src = allTextures.explode3;
            // } else if (obj[i].duration.current/obj[i].duration.all < 1/3) {
            //   //img.src = "img/explode1.png";
            //   img.src = allTextures.explode1;
            // }
            // ctx.drawImage(img, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);

            // if (obj[i].duration.current/obj[i].duration.all > 2/3) {
            //   ctx.drawImage(imgExplode3, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
            // } else if (obj[i].duration.current/obj[i].duration.all < 1/3) {
            //   ctx.drawImage(imgExplode1, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
            // } else {
            //   ctx.drawImage(imgExplode2, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);
            // }
            if (obj[i].side == 1) {
              ctx.scale(-1, 1);
            }

            if (obj[i].duration.current/obj[i].duration.all > 2/3) {
              ctx.drawImage(imgExplode3, 0, 0, obj[i].size.w, -obj[i].size.h);
            } else if (obj[i].duration.current/obj[i].duration.all < 1/3) {
              ctx.drawImage(imgExplode1, 0, 0, obj[i].size.w, -obj[i].size.h);
            } else {
              ctx.drawImage(imgExplode2, 0, 0, obj[i].size.w, -obj[i].size.h);
            }

            if (obj[i].duration.current < obj[i].duration.all) {
              obj[i].duration.current++;
            } else {
              obj.splice(obj.indexOf(obj[i]), 1);
            }

            ctx.closePath();
      			ctx.restore();
          }
        }
        //draw bullets
        for (var i in obj) {
          if (obj[i].tag == "bullet") {

            obj[i].coordinate.x += obj[i].speed.x;
            obj[i].coordinate.y += obj[i].speed.y;

            ctx.save();
      			ctx.beginPath();
      			ctx.translate(obj[i].coordinate.x, obj[i].coordinate.y);
            ctx.globalCompositeOperation = 'source-over';
      			ctx.arc(0, 0, obj[i].r, 0, 2*Math.PI);
      			ctx.fillStyle = obj[i].color;
      			ctx.fill();
      			ctx.restore();

            //gravitation
            obj[i].speed.x += g.x;
            obj[i].speed.y += g.y;
            //air resistance
            obj[i].speed.x += -Math.sign(obj[i].speed.x)*ar;
            obj[i].speed.y += -Math.sign(obj[i].speed.y)*ar;
            //destroy edge
            if (obj[i].coordinate.y >= 0.95*hh || obj[i].coordinate.x >= 1*ww || obj[i].coordinate.x <= 0) {
              obj.splice(obj.indexOf(obj[i]), 1);
              continue;
            }
            //collision
            for (var j in obj) {
              if (obj[j] != obj[i]) {
                if (obj[j].tag == "floor") {
                  //go to floor cs
                  var x = obj[i].coordinate.x-obj[j].coordinate.x;
                  var y = obj[i].coordinate.y-obj[j].coordinate.y;
                  var xx = x*Math.cos(obj[j].deg)+y*Math.sin(obj[j].deg);
                  var yy = -x*Math.sin(obj[j].deg)+y*Math.cos(obj[j].deg);
                  // yy = yy*(ww/hh);
                  // xx = xx*(hh/ww);

                  if (xx > (-obj[j].size.w/2)-obj[i].r && xx < (obj[j].size.w/2)+obj[i].r && yy > (-obj[j].size.h/2)-obj[i].r && yy < (obj[j].size.h/2)+obj[i].r && !bulletIntoHole(obj[i])) {
                    var hole = {
                      tag: "hole",
                      coordinate: {
                        x: obj[i].coordinate.x,
                        y: obj[i].coordinate.y
                      },
                      r: obj[i].r*10
                    };

                    var sideExplode = 1;
                    if (obj[i].speed.x < 0) {
                      sideExplode = 2;
                    }

                    var explode = {
                      tag: "explode",
                      coordinate: {
                        x: obj[i].coordinate.x,
                        y: obj[i].coordinate.y
                      },
                      size: {
                        w: 250,
                        h: 250
                      },
                      duration: {
                        all: 10,
                        current: 0
                      },
                      side: sideExplode
                    };

                    obj.splice(obj.indexOf(obj[i]), 1);

                    obj.push(hole);


                    //console.log(explode);

                    obj.push(explode);

                    for (var k = 0; k < obj.length; k++) {
                      if (obj[i]) {
                        if (obj[k].tag == "cannon") {
                          if ( Math.sqrt(Math.pow(hole.coordinate.x-obj[k].coordinate.x, 2)+Math.pow(hole.coordinate.y-obj[k].coordinate.y, 2)) <= hole.r+obj[k].size.h) {

                            if (obj[k].coordinate.x < 0.5*ww && ((me.turn && me.side == 1) || (!me.turn && me.side == 2)) ) {
                              finishData.destroyed.p2++;
                            } else if (obj[k].coordinate.x > 0.5*ww && ((me.turn && me.side == 2) || (!me.turn && me.side == 1)) ) {
                              finishData.destroyed.p1++;
                            }

                            obj.splice(obj.indexOf(obj[k]), 1);
                          }
                        }
                      }
                    }

                    var alive = {p1: 0, p2: 0};
                    for (var k = 0; k < obj.length; k++) {
                      if (obj[k]) {
                        if (obj[k].tag == "cannon") {
                          if (obj[k].coordinate.x < 0.5*ww) {
                            alive.p1++;
                          } else if (obj[k].coordinate.x > 0.5*ww) {
                            alive.p2++;
                          }
                        }
                      }
                    }

                    if (alive.p1 == 0) {
                      //if (me.side == 1) {
                        //socket.emit('exitGame', idRoom, 2);
                        setTimeout(function() {
                          finishData.winner = 2;

                          finishData.percentage.p1 = Math.round((finishData.destroyed.p1/finishData.shoots.p1)*100)/100;
                          finishData.percentage.p2 = Math.round((finishData.destroyed.p2/finishData.shoots.p2)*100)/100;

                          // finishData.averageRange.p1 = Math.round(getAverage(finishData.ranges.p1)*100)/100;
                          // finishData.averageRange.p2 = Math.round(getAverage(finishData.ranges.p2)*100)/100;

                          finishData.averageForcesShooting.p1 = Math.round(getAverage(finishData.forcesShooting.p1)*100)/100;
                          finishData.averageForcesShooting.p2 = Math.round(getAverage(finishData.forcesShooting.p2)*100)/100;

                          // //new rating
                          // var mathexpect = 1/(1+Math.pow(10, ((enemy.rating-me.rating)/400)));
                          // var winpoint = 0;
                          // if ((finishData.winner == 1 && me.side == 1) || (finishData.winner == 2 && me.side == 2)) {
                          //   winpoint = 1;
                          // }
                          // var k = 10;
                          // addRating = k*(winpoint-mathexpect);
                          // //var newrating = me.rating+addRating;
                          //
                          // console.log("r = "+me.rating+" + "+k+"*("+winpoint+"-"+mathexpect+")");
                          // //end new rating

                          socket.emit('finishGame', idRoom, finishData);

                        }, 1000);
                      //}
                    } else if (alive.p2 == 0) {
                      //if (me.side == 1) {
                        //socket.emit('exitGame', idRoom, 1);
                        setTimeout(function() {
                          finishData.winner = 1;

                          finishData.percentage.p1 = Math.round((finishData.destroyed.p1/finishData.shoots.p1)*100)/100;
                          finishData.percentage.p2 = Math.round((finishData.destroyed.p2/finishData.shoots.p2)*100)/100;

                          // finishData.averageRange.p1 = Math.round(getAverage(finishData.ranges.p1)*100)/100;
                          // finishData.averageRange.p2 = Math.round(getAverage(finishData.ranges.p2)*100)/100;

                          finishData.averageForcesShooting.p1 = Math.round(getAverage(finishData.forcesShooting.p1)*100)/100;
                          finishData.averageForcesShooting.p2 = Math.round(getAverage(finishData.forcesShooting.p2)*100)/100;

                          // //new rating
                          // var mathexpect = 1/(1+Math.pow(10, ((enemy.rating-me.rating)/400)));
                          // var winpoint = 0;
                          // if ((finishData.winner == 1 && me.side == 1) || (finishData.winner == 2 && me.side == 2)) {
                          //   winpoint = 1;
                          // }
                          // var k = 10;
                          // addRating = k*(winpoint-mathexpect);
                          // //var newrating = me.rating+addRating;
                          //
                          // console.log("r = "+me.rating+" + "+k+"*("+winpoint+"-"+mathexpect+")");
                          // //end new rating

                          socket.emit('finishGame', idRoom, finishData);

                        }, 1000);
                      //}
                    }

                    break;
                  }
                }
              }
            }

          }
        }

        //draw cannons
        for (var i in obj) {
           if (obj[i].tag == "cannon") {
            ctx.save();
    				ctx.beginPath();
    				ctx.translate(obj[i].coordinate.x, obj[i].coordinate.y);
            ctx.globalCompositeOperation = 'source-over';


            if (obj[i].coordinate.x > ww/2) {
              ctx.scale(-1, 1);
            }

            // console.log(imgobjitemCannon1);
            // var urlCannon = {c1: imgobjitemCannon1, c2: imgobjitemCannon2};
            //console.log(me.textures);
            var urlCannon = {c1: imgobjitemcannon1, c2: imgobjitemcannon1};
            if (me.textures && enemy.textures) {
              urlCannon = {c1: me.textures.cannon1, c2: me.textures.cannon2};
              if ( (me.side == 1 && obj[i].coordinate.x > ww/2) || (me.side == 2 && obj[i].coordinate.x < ww/2) ) {
                urlCannon = {c1: enemy.textures.cannon1, c2: enemy.textures.cannon2};
              }
            }

            if (obj[i].temporary && obj[i].temporary == "1") {
              ctx.globalAlpha = 0.5;
            }

            ctx.rotate(obj[i].angle);
            //var img = new Image();
            //img.src = obj[i].barrelUrl;
            //img.src = urlCannon.c2;
            ctx.drawImage(urlCannon.c2, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);

            ctx.rotate(-obj[i].angle);
            //var img = new Image();
            //img.src = obj[i].wheelUrl;
            //img.src = urlCannon.c1;
            ctx.drawImage(urlCannon.c1, -obj[i].size.w/2, -obj[i].size.h/2, obj[i].size.w, obj[i].size.h);

            // if (obj[i].choosen) {
            //   var img = new Image();
            //   img.src = "img/arrow.png";
            //   ctx.drawImage(img, -12, -obj[i].size.h/2-30-10, 25, 30);
            // }
            ctx.closePath();
    				ctx.restore();
          }
        }

        //draw water
        ctx.save();
				ctx.beginPath();
				ctx.translate(0, 0.92*hh);
        //var img = new Image();
        //img.src = "img/water.png";
        //img.src = allTextures.water;
        ctx.drawImage(imgobjwater, 0, 0, ww, 0.08*hh);
				// ctx.rect(0, 0, ww, 0.05*hh);
				// ctx.fillStyle = "#001485";
				// ctx.fill();
				ctx.restore();


        if (gui) {
          //draw timer
          if (gui.timer.visible) {
            ctx.save();
            ctx.beginPath();
            ctx.translate(gui.timer.coordinate.x, gui.timer.coordinate.y);
            ctx.font = gui.timer.size.font+"px Arial";
            ctx.fillStyle = gui.timer.color;
            ctx.textAlign = "center";
            ctx.fillText(secToMin(gui.timer.val), 0, 0, gui.timer.size.w);
            ctx.closePath();
            ctx.restore();
          }

          //draw ready button
          if (gui.buttonReady.visible) {
            ctx.save();
            ctx.beginPath();
            ctx.translate(gui.buttonReady.coordinate.x, gui.buttonReady.coordinate.y);
            //var img = new Image();
            //img.src = gui.buttonReady.urlBack;
            ctx.drawImage(gui.buttonReady.urlBack, -gui.buttonReady.size.w/2, -gui.buttonReady.size.h/2, gui.buttonReady.size.w, gui.buttonReady.size.h);
            // ctx.fillStyle = gui.buttonReady.colorBack;
            // ctx.rect(-gui.buttonReady.size.w/2, -gui.buttonReady.size.h/2, gui.buttonReady.size.w, gui.buttonReady.size.h);
            // ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.translate(gui.buttonReady.coordinate.x, gui.buttonReady.coordinate.y);
            ctx.font = gui.buttonReady.size.font+"px Arial";
            ctx.fillStyle = gui.buttonReady.colorText;
            ctx.textAlign = "center";
            ctx.fillText(gui.buttonReady.title, 0, 10, gui.buttonReady.size.w);
            ctx.closePath();
            ctx.restore();
          }

          //draw inventar build
          if (gui.inventarBuilt.visible) {
            for (i in gui.inventarBuilt.contain) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.inventarBuilt.coordinate.x, gui.inventarBuilt.coordinate.y);

              if (gui.inventarBuilt.contain[i].active) {
                ctx.globalAlpha = 1;
              } else if (!gui.inventarBuilt.contain[i].active) {
                ctx.globalAlpha = 0.5;
              }

              //console.log(gui.inventarBuilt.contain[i].url);
              if (gui.inventarBuilt.contain[i].url) {
                //var img = new Image();
                //img.src = gui.inventarBuilt.contain[i].url;
                ctx.drawImage(gui.inventarBuilt.contain[i].url, i*(gui.inventarBuilt.sizeIco.w+gui.inventarBuilt.margin), gui.inventarBuilt.margin, gui.inventarBuilt.sizeIco.w, gui.inventarBuilt.sizeIco.h);
              } else {
                ctx.rect(i*(gui.inventarBuilt.sizeIco.w+gui.inventarBuilt.margin), gui.inventarBuilt.margin, gui.inventarBuilt.sizeIco.w, gui.inventarBuilt.sizeIco.h);
                ctx.fillStyle = gui.inventarBuilt.contain[i].color;
                ctx.fill();
              }
              ctx.closePath();
              if (gui.inventarBuilt.contain[i].counter) {
                ctx.fillStyle = "#fff";
                ctx.font = '16px Arial';
                ctx.fillText(gui.inventarBuilt.contain[i].counter, i*(gui.inventarBuilt.sizeIco.w+gui.inventarBuilt.margin)+5, gui.inventarBuilt.margin+gui.inventarBuilt.sizeIco.h-5, gui.inventarBuilt.sizeIco.w);
              }
              ctx.restore();
            }
          }

          if (gui.aim.visible) {
            if (me.side == 1) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.aim.coordinate.x, gui.aim.coordinate.y);
              var img = new Image();
              img.src = "img/aimL.png";
              ctx.drawImage(img, 0, -gui.aim.r, gui.aim.r, gui.aim.r);
              // ctx.moveTo(gui.aim.coordinate.x, gui.aim.coordinate.y);
              // ctx.arc(gui.aim.coordinate.x, gui.aim.coordinate.y, gui.aim.r, -Math.PI/2, 0);
              // ctx.fillStyle = gui.aim.color;
              // ctx.fill();
              ctx.closePath();
              ctx.restore();
            }  else if (me.side == 2) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(ww-gui.aim.coordinate.x, gui.aim.coordinate.y);
              var img = new Image();
              img.src = "img/aimR.png";
              ctx.drawImage(img, -gui.aim.r, -gui.aim.r, gui.aim.r, gui.aim.r);
              // ctx.moveTo(ww-gui.aim.coordinate.x, gui.aim.coordinate.y);
              // ctx.arc(ww-gui.aim.coordinate.x, gui.aim.coordinate.y, gui.aim.r, -Math.PI, -Math.PI/2);
              // ctx.fillStyle = gui.aim.color;
              // ctx.fill();
              ctx.closePath();
              ctx.restore();
            }

            if (me.side == 1) {
              ctx.save();
              ctx.beginPath();
              ctx.moveTo(gui.aim.coordinate.x, gui.aim.coordinate.y);
              ctx.arc(gui.aim.coordinate.x+gui.aim.turn.coordinate.x, gui.aim.coordinate.y+gui.aim.turn.coordinate.y, gui.aim.turn.r, 0, Math.PI*2);
              ctx.fillStyle = gui.aim.turn.color;
              ctx.fill();
              ctx.closePath();
              ctx.restore();
            } else if (me.side == 2) {
              ctx.save();
              ctx.beginPath();
              ctx.moveTo(ww-gui.aim.coordinate.x, gui.aim.coordinate.y);
              ctx.arc(ww-gui.aim.coordinate.x+gui.aim.turn.coordinate.x, gui.aim.coordinate.y+gui.aim.turn.coordinate.y, gui.aim.turn.r, 0, Math.PI*2);
              ctx.fillStyle = gui.aim.turn.color;
              ctx.fill();
              ctx.closePath();
              ctx.restore();
            }
          }

          if (gui.buttonShot.visible) {
            if (me.side == 1) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.buttonShot.coordinate.x, gui.buttonShot.coordinate.y);
              ctx.rect(0, 0, gui.buttonShot.size.w, gui.buttonShot.size.h);
              ctx.closePath();
              ctx.fillStyle = gui.buttonShot.color;
              ctx.fill();
              ctx.restore();

              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.buttonShot.coordinate.x, gui.buttonShot.coordinate.y);
              ctx.font = gui.buttonShot.size.font+"px Arial";
              ctx.fillStyle = gui.buttonShot.colorText;
              ctx.textAlign = "center";
              ctx.fillText(gui.buttonShot.title, gui.buttonShot.size.w/2, gui.buttonShot.size.h/2+10, gui.buttonShot.size.w);
              ctx.closePath();
              ctx.restore();
            } else if (me.side == 2) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(ww-gui.buttonShot.coordinate.x, gui.buttonShot.coordinate.y);
              ctx.rect(0, 0, -gui.buttonShot.size.w, gui.buttonShot.size.h);
              ctx.closePath();
              ctx.fillStyle = gui.buttonShot.color;
              ctx.fill();
              ctx.restore();

              ctx.save();
              ctx.beginPath();
              ctx.translate(ww-gui.buttonShot.coordinate.x, gui.buttonShot.coordinate.y);
              ctx.font = gui.buttonShot.size.font+"px Arial";
              ctx.fillStyle = gui.buttonShot.colorText;
              ctx.textAlign = "center";
              ctx.fillText(gui.buttonShot.title, -gui.buttonShot.size.w/2, gui.buttonShot.size.h/2+10, gui.buttonShot.size.w);
              ctx.closePath();
              ctx.restore();
            }
          }

          //draw lfHintControl hintControlRClick
          if (gui.hintControl.visible) {
            if (me.side == 1) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(ww-gui.hintControl.coordinate.x, gui.hintControl.coordinate.y);
              //var img = new Image();
              //img.src = gui.hintControl.url;
              ctx.drawImage(gui.hintControl.url, -gui.hintControl.size.imgw, 0, gui.hintControl.size.imgw, gui.hintControl.size.imgh);
              ctx.closePath();
              ctx.restore();

              ctx.save();
              ctx.beginPath();
              ctx.translate(ww-(gui.hintControl.coordinate.x+gui.hintControl.size.imgw), gui.hintControl.coordinate.y);
              ctx.font = gui.hintControl.size.font+"px Arial";
              ctx.fillStyle = gui.hintControl.colorText;
              ctx.textAlign = "right";
              ctx.fillText(gui.hintControl.title, -gui.hintControl.size.imgw+80, gui.hintControl.size.imgh/2+15);
              ctx.closePath();
              ctx.restore();
            } else if (me.side == 2) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.hintControl.coordinate.x, gui.hintControl.coordinate.y);
              //var img = new Image();
              //img.src = gui.hintControl.url;
              ctx.drawImage(gui.hintControl.url, 0, 0, gui.hintControl.size.imgw, gui.hintControl.size.imgh);
              ctx.closePath();
              ctx.restore();

              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.hintControl.coordinate.x+gui.hintControl.size.imgw, gui.hintControl.coordinate.y);
              ctx.font = gui.hintControl.size.font+"px Arial";
              ctx.fillStyle = gui.hintControl.colorText;
              ctx.textAlign = "left";
              ctx.fillText(gui.hintControl.title, 0, gui.hintControl.size.imgh/2+15);
              ctx.closePath();
              ctx.restore();
            }
            }

            //draw hintControlRClick
            if (gui.hintControlRClick.visible) {
              if (me.side == 1) {
                ctx.save();
                ctx.beginPath();
                ctx.translate(ww-gui.hintControlRClick.coordinate.x, gui.hintControlRClick.coordinate.y);
                //var img = new Image();
                //img.src = gui.hintControlRClick.url;
                ctx.drawImage(imgobjrightClick, -gui.hintControlRClick.size.imgw, 0, gui.hintControlRClick.size.imgw, gui.hintControlRClick.size.imgh);
                ctx.closePath();
                ctx.restore();

                ctx.save();
                ctx.beginPath();
                ctx.translate(ww-(gui.hintControlRClick.coordinate.x+gui.hintControlRClick.size.imgw), gui.hintControlRClick.coordinate.y);
                ctx.font = gui.hintControlRClick.size.font+"px Arial";
                ctx.fillStyle = gui.hintControlRClick.colorText;
                ctx.textAlign = "right";
                ctx.fillText(gui.hintControlRClick.title, -gui.hintControlRClick.size.imgw+80, gui.hintControlRClick.size.imgh/2+15);
                ctx.closePath();
                ctx.restore();
              } else if (me.side == 2) {
                ctx.save();
                ctx.beginPath();
                ctx.translate(gui.hintControlRClick.coordinate.x, gui.hintControlRClick.coordinate.y);
                //var img = new Image();
                //img.src = gui.hintControlRClick.url;
                ctx.drawImage(imgobjrightClick, 0, 0, gui.hintControlRClick.size.imgw, gui.hintControlRClick.size.imgh);
                ctx.closePath();
                ctx.restore();

                ctx.save();
                ctx.beginPath();
                ctx.translate(gui.hintControlRClick.coordinate.x+gui.hintControlRClick.size.imgw, gui.hintControlRClick.coordinate.y);
                ctx.font = gui.hintControlRClick.size.font+"px Arial";
                ctx.fillStyle = gui.hintControlRClick.colorText;
                ctx.textAlign = "left";
                ctx.fillText(gui.hintControlRClick.title, 0, gui.hintControlRClick.size.imgh/2+15);
                ctx.closePath();
                ctx.restore();
              }
            }
            //draw hintControlChoose
            if (gui.hintControlChoose.visible) {
                ctx.save();
                ctx.beginPath();
                ctx.translate(gui.hintControlChoose.coordinate.x, gui.hintControlChoose.coordinate.y);
                //var img = new Image();
                //img.src = gui.hintControlChoose.url;
                ctx.drawImage(gui.hintControlChoose.url, 0, 0, gui.hintControlChoose.size.imgw, gui.hintControlChoose.size.imgh);
                ctx.closePath();
                ctx.restore();
            }

            //draw labelChooseCannon
            if (gui.labelChooseCannon.visible) {
              ctx.save();
              ctx.beginPath();
              if (me.side == 1) {
                ctx.translate(gui.labelChooseCannon.coordinate.x, gui.labelChooseCannon.coordinate.y);
              } else if (me.side == 2) {
                ctx.translate(ww-gui.labelChooseCannon.coordinate.x, gui.labelChooseCannon.coordinate.y);
              }
              ctx.font = gui.labelChooseCannon.size.font+"px Arial";
              ctx.fillStyle = gui.labelChooseCannon.colorText;
              ctx.textAlign = "center";
              ctx.fillText(gui.labelChooseCannon.title, 0, 0, gui.labelChooseCannon.size.w);
              ctx.closePath();
              ctx.restore();
            }

            //draw labelYourTurn
            if (gui.labelYourTurn.visible) {
              ctx.save();
              ctx.beginPath();
              var text = "";
              var color = "";
              if (me.turn) {
                text = "your turn";
                color = "#ff0000";
              } else if (enemy.turn) {
                text = "enemy turn";
                color = "#fff";
              }
              ctx.translate(gui.labelYourTurn.coordinate.x, gui.labelYourTurn.coordinate.y);
              ctx.font = gui.labelYourTurn.size.font+"px Arial";
              ctx.fillStyle = color;
              ctx.textAlign = "center";
              ctx.fillText(text, 0, 0, gui.labelYourTurn.size.w);
              ctx.closePath();
              ctx.restore();
            }

            //draw labelNameL
            if (gui.labelNameL.visible == true) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.labelNameL.coordinate.x, gui.labelNameL.coordinate.y);
              ctx.font = gui.labelNameL.size.font+"px Arial";
              ctx.fillStyle = gui.labelNameL.colorText;
              ctx.textAlign = "center";
              var text = "";
              if (enemy.bot) {
                if (me.side == 1) {
                  text = me.name;
                } else if (me.side == 2) {
                  text = "";
                }
              } else {
                if (me.side == 1) {
                  text = me.name;
                } else if (me.side == 2) {
                  text = enemy.name;
                }
              }
              ctx.fillText(text, 0, 0, gui.labelNameL.size.w);
              ctx.closePath();
              ctx.restore();
            }

            //draw labelNameR
            if (gui.labelNameR.visible == true) {
              ctx.save();
              ctx.beginPath();
              ctx.translate(gui.labelNameR.coordinate.x, gui.labelNameR.coordinate.y);
              ctx.font = gui.labelNameR.size.font+"px Arial";
              ctx.fillStyle = gui.labelNameR.colorText;
              ctx.textAlign = "center";
              var text = "";
              if (enemy.bot) {
                if (me.side == 1) {
                  text = "";
                } else if (me.side == 2) {
                  text = me.name;
                }
              } else {
                if (me.side == 1) {
                  text = enemy.name;
                } else if (me.side == 2) {
                  text = me.name;
                }
              }
              ctx.fillText(text, 0, 0, gui.labelNameR.size.w);
              ctx.closePath();
              ctx.restore();
            }

            //draw vectorShoot
            var isphone = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
            var addVectorShoot = 0;
            if (isphone && me.side == 1) {
              addVectorShoot = 0.2*ww;
            } else if (isphone && me.side == 2) {
              addVectorShoot = -0.2*ww;
            }

            var maxSpeedBullet = 280;
            var addTrans = 100;
            var r = Math.sqrt(Math.pow(gui.vectorShoot.coor2.x-gui.vectorShoot.coor1.x, 2)+Math.pow(gui.vectorShoot.coor2.y-gui.vectorShoot.coor1.y, 2));
            var f = Math.atan(Math.abs((gui.vectorShoot.coor2.y-gui.vectorShoot.coor1.y)/(gui.vectorShoot.coor2.x-gui.vectorShoot.coor1.x)));
            if (r > maxSpeedBullet) {
              r = maxSpeedBullet;
            }
            var x = r*Math.cos(f);
            var y = -r*Math.sin(f);

            var x1 = addTrans*Math.cos(f);
            var y1 = -addTrans*Math.sin(f);

            if (me.side == 2) {
              x = -1*x;
              x1 = -1*x1;
            }
            if (gui.vectorShoot.visible == true) {
              ctx.save();
              ctx.translate(gui.vectorShoot.coor1.x, gui.vectorShoot.coor1.y);

              // ctx.beginPath();
              // ctx.moveTo(x1, y1);
              // ctx.lineTo(x, y);
              // ctx.strokeStyle = gui.vectorShoot.color;
              // ctx.stroke();
              // ctx.closePath();


              // ctx.rotate(-f);
              // ctx.globalCompositeOperation = 'source-over';
              // var img = new Image();
              // img.src = "img/animateTrack.gif";
              // ctx.drawImage(gif, 0, addTrans, 10, 400);

              var dottedPerVector = 10;
              var inter = (maxSpeedBullet-addTrans)/dottedPerVector;
              for (var i = 0; i < dottedPerVector; i++) {
                var k = 1;
                if (me.side == 2) {
                  k = -1;
                }
                var currx = x1+k*(inter*i)*Math.cos(f)+k*gui.vectorShoot.shift*Math.cos(f)+addVectorShoot;
                var curry = y1-(inter*i)*Math.sin(f)-gui.vectorShoot.shift*Math.sin(f);

                if ((currx > x+addVectorShoot && me.side == 1) || (currx < x+addVectorShoot && me.side == 2) || curry < y) {
                  break;
                }

                ctx.beginPath();
                ctx.arc(currx, curry, 3, 0, Math.PI*2);
                ctx.fillStyle = gui.vectorShoot.color;
                ctx.fill();
                ctx.closePath();
              }


              ctx.restore();

              gui.vectorShoot.shift += 0.05*inter;
              if (gui.vectorShoot.shift > inter) {
                gui.vectorShoot.shift = 0;
              }
            }

            //draw circleShoot
            if (gui.circleShoot.visible == true) {
              // ctx.save();
              // var addTranslate = 100;
              // addTranslate = -(addTranslate)*(2/Math.PI)*Math.atan(gui.circleShoot.scale.y/gui.circleShoot.scale.x)+addTranslate;
              // if (me.side == 2) {
              //   addTranslate = -1*addTranslate;
              // }
              // //var addTranslateY = (addTranslate)*(2/Math.PI)*Math.atan(gui.circleShoot.scale.y/gui.circleShoot.scale.x);
              // //console.log(addTranslateY);
              // ctx.translate(gui.circleShoot.coordinate.x+addTranslate, gui.circleShoot.coordinate.y);
              // ctx.scale(gui.circleShoot.scale.x, gui.circleShoot.scale.y);
              // var interval = (2*Math.PI)/gui.circleShoot.dot.frequency;
              // for (var i = 0; i < gui.circleShoot.dot.frequency; i++) {
              //     var desiredRadianAngleOnCircle = interval*i;
              //     var x = gui.circleShoot.radius*Math.cos(desiredRadianAngleOnCircle+gui.circleShoot.shift);
              //     var y = gui.circleShoot.radius*Math.sin(desiredRadianAngleOnCircle+gui.circleShoot.shift);
              //
              //     if (y < -gui.circleShoot.radius*0.1 && ((x < -gui.circleShoot.radius*0.8 && me.side == 1) || (x > gui.circleShoot.radius*0.8 && me.side == 2)) ) {
              //     ctx.beginPath();
              //     //ctx.arc(x, y, gui.circleShoot.dot.radius*10/(Math.sqrt(Math.pow(gui.circleShoot.scale.x, 2)+Math.pow(gui.circleShoot.scale.y, 2))), 0, Math.PI*2);
              //     ctx.ellipse(x, y, gui.circleShoot.dot.radius/gui.circleShoot.scale.x, gui.circleShoot.dot.radius/gui.circleShoot.scale.y, 0, 0, Math.PI*2);
              //     ctx.closePath();
              //     ctx.fillStyle = gui.circleShoot.dot.color;
              //     ctx.fill();
              //     }
              // }
              //
              // ctx.restore();
            }
            //gui.circleShoot.shift += gui.circleShoot.speedAnimation;

        }

        cancelAnimationFrame(animateMenu);
        animateGame = requestAnimationFrame(draw);
      }

      //check additional
      var additional = getCookie("additional");
      if (additional && additional != "") {
        socket.emit('decryptAdditional', additional);
        socket.on('sendDecryptAdditional', function(add) {
          additionalGlobal = add;
          var addd = add.split(";");
          for (var i = 0; i < addd.length; i++) {
            var curr = addd[i].split("=");
            if (curr[0] == "rating" && parseInt(curr[1]) > 100) {
              $("#signButton").html("<span style='margin:0px;'>Sign in/up</span><span style='max-width:100px;margin:0px;font-size:10px;color:#ff7b7b;font-style:italic'>if you register you will get "+curr[1]+" rating point and items if you have</span>");
              $("#signButton").css("padding", "10px");
              break;
            }
          }
        });
      }

      socket.on('getAdditionalCookie', function() {
        if (additional && additional != "") {
          socket.emit('giveAdditionalCookie', additional);
        }
      });
      socket.on('removeAdditionalCookie', function() {
        removeCookie("additional");
      });

      //import code fortune
      var insertFortune = "";
      var counterAllUsers = 0;
      function fillFortune(items) {
        $("#fortuneFG").html("<div id='wrapArrowFG'><div id='arrowFortuneFG'></div></div>");

        $("#wrapArrowFG").css("position", "absolute");
        $("#wrapArrowFG").css("width", "41px");
        $("#wrapArrowFG").css("height", "20px");
        $("#wrapArrowFG").css("overflow", "hidden");
        $("#wrapArrowFG").css("margin-top", "90px");
        $("#wrapArrowFG").css("margin-left", "35px");

        $("#arrowFortuneFG").css("width", "30px");
        $("#arrowFortuneFG").css("height", "30px");
        $("#arrowFortuneFG").css("background-color", "#fff");
        $("#arrowFortuneFG").css("transform", "rotate(45deg)");
        $("#arrowFortuneFG").css("margin-top", "6px");
        $("#arrowFortuneFG").css("margin-left", "6px");

        $("#fortuneFG").show();
        $("#wrapArrowFG").show();
        $("#getItemFortune").show();

        items = items.split(";");

        // var countAllFortune = getAllFortune(items);
        // var percentageItems = [];
        // for (var i = 0; i < items.length; i++) {
        //   percentageItems[i] = parseInt(getDataItem(items[i].split(","), "fortune"))/countAllFortune;
        // }

        while (items.length != 0) {
          items = addRandomItemsFortune(items);
        }

        $(".itemFortune").css("width", "90px");
        $(".itemFortune").css("height", "90px");
        $(".itemFortune").css("display", "inline-block");
        $(".itemFortune").css("margin", "0px 0px");
        $(".itemFortune").css("background-position", "center");
        $(".itemFortune").css("background-size", "contain");
        $(".itemFortune").css("background-repeat", "no-repeat");
        // $(".itemFortune").css("transition", "margin cubic-bezier(0.01, 0.43, 0.49, 1) 10s");
        // $(".itemFortune").css("-webkit-transition", "margin cubic-bezier(0.01, 0.43, 0.49, 1) 10s");
        // $(".itemFortune").css("-moz-transition", "margin cubic-bezier(0.01, 0.43, 0.49, 1) 10s");
        // $(".itemFortune").css("-o-transition", "margin cubic-bezier(0.01, 0.43, 0.49, 1) 10s");
      }

      var timeoutTwist = setTimeout(function () {}, 0);
      function twistFortune(fortune) {
        var widthOneItem = 100;
        var lengthItems = fortune.children(".itemFortune").length;
        var randomNumber = getRandomInt(20, 80)/100;
        var lengthTwist = Math.round((lengthItems*widthOneItem)*randomNumber);
        // if (lengthTwist%110 <= 10) {
        //   var sign = getRandomInt(0, 2);
        //   if (sign == 0) {
        //     sign = -1;
        //   } else if (sign == 1) {
        //     sign = 1;
        //   }
        //   lengthTwist += sign*10;
        // }

        var objectGetFortune = $(".itemFortune").eq(Math.floor(lengthTwist/widthOneItem)+1);
        // console.log(Math.floor(lengthTwist/widthOneItem)+2);
        //console.log(objectGetFortune.attr("idfortune"));

        //fortune.children().eq(1).css("margin-left", "-"+(lengthTwist+57)+"px");

        fortune.children().eq(1).animate({
          "margin-left": -(lengthTwist+57)
        }, 10000);

        timeoutTwist = setTimeout(function () {
          domGetItemFortune(objectGetFortune);
        }, 10000);

        $(document).on("click", function() {
            domGetItemFortune(objectGetFortune);
            clearInterval(timeoutTwist);
            fortune.children().eq(1).stop(false, true);
        });

        return objectGetFortune.attr("idfortune");
      }

      function domGetItemFortune(objGF) {
        if (objGF.attr("idfortune") == "0") {
          $("#nameGetItemFortune").html("Nothing");
        } else {
          var ttype = objGF.attr("ttype");
          if (ttype == "cannon1") {
            ttype = "You get wheel: ";
          } else if (ttype == "cannon2") {
            ttype = "You get barrel: ";
          } else if (ttype == "wall") {
            ttype = "You get wall: ";
          }
          var rare = Number(objGF.attr("rrare"));
          var descriptRare = "usual";
          if (rare <= 0.8 && rare > 0.6) {
            descriptRare = "good";
          } else if (rare <= 0.6 && rare > 0.4) {
            descriptRare = "cool";
          } else if (rare <= 0.4 && rare > 0.2) {
            descriptRare = "rare";
          } else if (rare <= 0.2 && rare > 0.02) {
            descriptRare = "fantastic";
          } else if (rare <= 0.02 && rare >= 0) {
            descriptRare = "almost unique";
          }
          $("#nameGetItemFortune").html(ttype+objGF.attr("nname"));
          $("#rareGetItemFortune").html("Rarity factor: "+rare+" ("+descriptRare+")");
          $("#rareGetItemFortune").css("background-color", objGF.attr("ccolor"));
        }
      }

      function addRandomItemsFortune(itemsAEIF, percentageItemsAEIF) {
        // //get number item
        // var randomInt = getRandomInt(0, 100)/100;
        // var n = 0;
        // var shiftn = 0;
        // for (var i = 0; i < itemsAEIF.length; i++) {
        //   if (randomInt >= shiftn && randomInt < shiftn+percentageItemsAEIF[i+1]) {
        //     n = i;
        //     break;
        //   }
        //   shiftn += percentageItemsAEIF[i]
        // }
        // //end get number item

        var maxLengthSpace = 10;

        //make space
        var lengthSpace = getRandomInt(0, maxLengthSpace);
        for (var i = 0; i < lengthSpace; i++) {
          //id=0,name=!none,type=!none,received=!none,fortune=50;
          domItem(["id=0", "name=!none", "type=!none", "received=!none", "fortune=0"]);
        }
        //end make space

        var n = getRandomInt(0, itemsAEIF.length);
        var currentItem = itemsAEIF[n].split(",");
        domItem(currentItem);
        var fortune = parseInt(getDataItem(currentItem, "fortune"));

        if (fortune == 1) {
          itemsAEIF = removeFortuneItem(itemsAEIF, getDataItem(currentItem, "id"));
        } else if (fortune > 1) {
          currentItem = minusFortuneItem(currentItem);
          itemsAEIF = updateFortuneItem(itemsAEIF, currentItem);
        }

        //make space
        lengthSpace = getRandomInt(0, maxLengthSpace);
        for (var i = 0; i < lengthSpace; i++) {
          //id=0,name=!none,type=!none,received=!none,fortune=50;
          domItem(["id=0", "name=!none", "type=!none", "received=!none", "fortune=0"]);
        }
        //end make space

        return itemsAEIF;
      }

      function domItem(itemDI) {
        if (getDataItem(itemDI, "name") == "!none") {
          $("#fortuneFG").append("<div class='itemFortune' style='border: solid 5px #00000000;' idfortune='"+getDataItem(itemDI, "id")+"'></div>");
        } else {
          var rare = Math.round((parseInt(getDataItem(itemDI, "received"))/counterAllUsers)*100000)/100000;
          var color = getColorInOrder(rare);

          $("#fortuneFG").append("<div rrare='"+rare+"' ccolor='"+color+"' nname='"+getDataItem(itemDI, "name")+"' ttype='"+getDataItem(itemDI, "type")+"' class='itemFortune' idfortune='"+getDataItem(itemDI, "id")+"' style='border: solid 5px "+color+";background-image:url(\"/g/cannons/img/items/"+getDataItem(itemDI, "type")+"_"+getDataItem(itemDI, "name")+".png\");'></div>");
        }
      }

      function minusFortuneItem(attributesMFI) {
        for (var i = 0; i < attributesMFI.length; i++) {
          var currAttr = attributesMFI[i].split("=");
          if (currAttr[0] == "fortune") {
            attributesMFI[i] = currAttr[0]+"="+(parseInt(currAttr[1])-1);
            return attributesMFI;
          }
        }
        return false;
      }

      function updateFortuneItem(itemsUFI, updateItemUFI) {
        updateItemUFI = updateItemUFI.join(",");
        for (var i = 0; i < itemsUFI.length; i++) {
          if (getDataItem(itemsUFI[i].split(","), "id") == getDataItem(updateItemUFI.split(","), "id")) {
            itemsUFI[i] = updateItemUFI;
            return itemsUFI;
          }
        }
        return false;
      }

      function removeFortuneItem(itemsRFI, idRFI) {
        for (var i = 0; i < itemsRFI.length; i++) {
          if (getDataItem(itemsRFI[i].split(","), "id") == idRFI) {
            itemsRFI.splice(i, 1);
            return itemsRFI;
          }
        }
        return false;
      }

      function getDataItem(attributesGDI, tagGDI) {
        for (var i = 0; i < attributesGDI.length; i++) {
          var currAttr = attributesGDI[i].split("=");
          if (currAttr[0] == tagGDI) {
            return currAttr[1];
          }
        }
        return false;
      }

      function getColorInOrder(index) {
        //ban is #ffXX00
        //#XX0000 #XXff00 #XX00ff #XXffff
        //#00XX00 #ffXX00 #00XXff #ffXXff
        //#0000XX #ff00XX #00ffXX #ffffXX
        // #ff00XX #XX00ff #00XXff #00ffXX #XXff00
        var sector = 0;
        for (var i = 0; i < 5; i++) {
          if (index > i*(1/5) && index <= (i+1)*(1/5) ) {
            sector = i;
          }
        }

        var varPart = Math.round((255*(index-sector*(1/5))*5)).toString(16);
        if (varPart.length < 2) {
          varPart = "0"+varPart;
        }
        var bright = "ff";

        switch (sector) {
          case 0:
            return "#"+bright+"00"+varPart;
            break;
          case 1:
            return "#"+varPart+"00"+bright;
            break;
          case 2:
            return "#00"+varPart+bright;
            break;
          case 3:
            return "#00"+bright+varPart;
            break;
          case 4:
            return "#"+varPart+bright+"00";
            break;
        }
      }

      function getAllFortune(itemsGAF) {
        var count = 0;
        for (var i = 0; i < itemsGAF.length; i++) {
          count += parseInt(getDataItem(itemsGAF[i].split(","), "fortune"));
        }
        return count;
      }
      //end import code fortune

      //check error
      var cookieError = getCookie("error");
      if (cookieError && cookieError != "") {

        showSign();

        $("#wrapSignSendEmail").hide();
        $("#wrapSignAnswerEmail1").hide();

        $("#textSignAnswer2").css("color", "#ff5252");
        $("#textSignAnswer2").html(cookieError);
        $("#backSign").show();
        $("#wrapSignAnswerEmail2").show();

        removeCookie("error");
      }

      //check signin
      var mid = getCookie("mid");
      var iduser = "!noid";
      if (mid && mid != "") {
        socket.emit('decryptMail', mid);
      } else {
        $("#signButton").css("display", "flex");
      }
      socket.on('sendDecryptMail', function(answer) {
        if (answer != "!nomail") {
          //$("#signButton").hide();

          answer = answer.split("|");
          iduser = answer[0];
          var link = "/g/cannons/stats/"+iduser;
          //$("#wrapProfileButton").show();
          $("#wrapProfileButton").css("display", "flex");
          $("#profileButton").attr("href", link);
        }
      });

      //cookie
      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString()+";";
        if (exdays == 0) {
          expires = "";
        }
        document.cookie = cname+"="+cvalue+";"+expires+"path=/";
      }

      function getCookie(name) {
        var cookie = document.cookie;
        cookie = cookie.split("; ");
        for (var i = 0; i < cookie.length; i++) {
          var oneCookie = cookie[i].split("=");
          if (name == oneCookie[0]) {
            return oneCookie[1];
          }
        }
        return false;
      }

      function removeCookie(name) {
        document.cookie = name+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      }
    </script>
  </body>

  <style>
    body {
      margin: 0px;
      padding: 0px;
    }
    #canvas {
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
    }
  </style>
</html>
