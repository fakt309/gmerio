<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Your studio</title>

    <link rel="stylesheet" href="/resource/styles/studio.css" />
  </head>
  <body>
    <div id='labelNearMouse'></div>

    <section id='backConfirmDeleteGame'>
      <div id='blockConfirmDeleteGame'>
        <div id='labelConfirmDeleteGame'>Are you sure you want to delete game from gmerio? Maybe you want to transit this game to us?  You can write to us by form on this site. We will answer you in short terms. We would glad to take it and maybe even pay you money.</div>
        <div id='buttonConfirmDeleteGame' onclick='deleteFoldersConfirmed()'>anyway delete game permanently</div>
      </div>
    </section>

    <section id='backConfirmDeleteStudio'>
      <div id='blockConfirmDeleteStudio'>
        <div id='labelConfirmDeleteStudio'>enter name studio to confirm it</div>
        <input id='inputConfirmDeleteStudio' type='text' />
        <div id='buttonConfirmDeleteStudio' onclick='deleteStudio()'>delete studio permanently</div>
      </div>
    </section>

    <section id='wrapAll'>
    <div id='insideWrapAll'>
    <div id='inside2WrapAll'>
      <div id='wrapLinkHome'>
        <a id='linkHome' href='/'>gmer.io</a>
      </div>
      <div id='mainNoBlock'>
        <p id='textNoBlock'>data for this studio not found</p>
      </div>
      <div id='mainBlock'>
        <div id='leftMenu'>
          <div class='linkMenu' onclick='showBlock(0, this)'>GMERIO</div>
          <div class='linkMenu' onclick='showBlock(1, this)'>games</div>
          <div class='linkMenu' onclick='showBlock(2, this)'>staff</div>
        </div>
        <div id='rightContent'>
          <div class='blockContent'>
            <div id='topStudio'>
              <div id='leftTopStudio'>
                <div id='titleStudio'></div>
                <div id='descrptionStudio'>
                  <p id='strokeDescriptionStudio'></p>
                  <div id='blockInputEditDescription' active='0'>
                    <div id='titleInputEditDescription'>description</div>
                    <textarea id='inputInputEditDescription' onfocusin='this.parentElement.setAttribute("focuse", "1")' onfocusout='this.parentElement.setAttribute("focuse", "0")' type='text'></textarea>
                  </div>
                  <div id='editDescriptionStudio' onclick='showEditDescInput(this)' condition='edit'></div>
                </div>
              </div>
              <div id='rightTopStudio'>
                <div class='blockStatsStudio'>
                  <div class='titleStatsStudio'>games created</div>
                  <div class='valueStatsStudio' id='valueStatsStudioGames'></div>
                </div>
                <div class='blockStatsStudio'>
                  <div class='titleStatsStudio'>number of staff</div>
                  <div class='valueStatsStudio' id='valueStatsStudioStaff'></div>
                </div>
              </div>
            </div>
            <div id='strokesInfo'>
              <div class='strokeInfoStudio'>
                <div class='titleStrokeInfoStudio'>key holder:</div>
                <div class='valueStrokeInfoStudio'><a class='linkUserStroke' id='linkHolderUser' href='/u/44'><span id='linkNameHolder'>none</span> (id:<span id='linkIdHolder'></span>)</a></div>
              </div>
              <div class='strokeInfoStudio'>
                <div class='titleStrokeInfoStudio'>date of foundation:</div>
                <div class='valueStrokeInfoStudio' id='dateFoundStudioValue'></div>
              </div>
            </div>
            <div id='stringControlStudio'>
              <div id='buttonDeleteStudio' onclick='showConfirmDeleteStudioWindow()'>delete studio</div>
            </div>
          </div>
          <div class='blockContent'>
            <div id='nogameText' active='0'>This studio don't have any game</div>
            <div id='listGames'></div>
            <div id='gamesFolders'>
              <div id='infoChoosenFolder'>
                <div id='fullWayChoosenFolder'><p id='hostWayChoosenFolder'>https://gmer.io</p><p id='pathWayChoosenFolder'></p></div>
                <div id='panelControl'>
                  <div id='renameFolderButton' onclick="showRenameFolder( document.querySelectorAll('.oneFolder[focus=\'1\']')[0] )">
                    <div id='imgRenameFolder'></div>
                    <div id='titleRenameFolderButton'>rename</div>
                  </div>
                  <div id='deleteFolderButton' onclick='confirmMouseDeleteFolders()'>
                    <div id='imgDeleteFolder'></div>
                    <div id='titleDeleteFolderButton'>delete</div>
                  </div>
                </div>
              </div>
              <div id='listFolders'></div>
            </div>
            <div id='stringCreateGame'>
              <div id='blockInputCreateGame' active='0'>
                <div id='titleInputCreateGame'>name game</div>
                <input id='inputInputCreateGame' oninput='validGameName(this)' onfocusin='this.parentElement.setAttribute("focuse", "1")' onfocusout='this.parentElement.setAttribute("focuse", "0")' type='text' />
              </div>
              <div id='buttonCreateGame' onclick='clickCreateGame()'>+ create new game</div>
              <div id='buttonCancelCreateGame' onclick='clickCancelCreateGame()' active='0'>cancel</div>
              <div id='errorTextCreateGame'></div>
            </div>
          </div>
          <div class='blockContent'>
            <div id='wrapTableStaff'>
              <table id='tableStaff'>
                <tr>
                  <td><div class='editUser'>&#8226;&#8226;&#8226;</div></td>
                  <td><div class='wrapTdTableStaff'><div class='key'></div><a class='linkUser' href='/u/44'>Vladimir G. (id:44)</a></div></td>
                  <td>founder</td>
                </tr>
                <tr>
                  <td><div class='editUser'>&#8226;&#8226;&#8226;</div></td>
                  <td><div class='wrapTdTableStaff'><a class='linkUser' href='/u/89'>Sama K. (id:89)</a></div></td>
                  <td>art designer</td>
                </tr>
                <tr>
                  <td><div class='editUser'>&#8226;&#8226;&#8226;</div></td>
                  <td><div class='wrapTdTableStaff'><a class='linkUser' href='/u/89'>G. (id:89)</a></div></td>
                  <td>art designer</td>
                </tr>
                <tr>
                  <td><div class='editUser'>&#8226;&#8226;&#8226;</div></td>
                  <td><div class='wrapTdTableStaff'><a class='linkUser' href='/u/89'>Sama K. (id:89)</a></div></td>
                  <td>sound producer</td>
                </tr>
              </table>
            </div>

            <div id='stringInviteUser'>
              <div id='blockInputInviteUser' active='0'>
                <div id='titleInputInviteUser'>id user</div>
                <input id='inputInputInviteUser' oninput='validUserName(this)' onfocusin='this.parentElement.setAttribute("focuse", "1")' onfocusout='this.parentElement.setAttribute("focuse", "0")' type='text' />
              </div>
              <div id='buttonInviteUser' onclick='clickInviteUser()'>+ invite user</div>
              <div id='buttonCancelInviteUser' onclick='clickCancelInviteUser()' active='0'>cancel</div>
            </div>
          </div>

        </div>
      </div>
    </div>
    </div>
    </section>

    <script src="/socket.io/socket.io.js"></script>
    <script src='/resource/js/users/getDeviceData.js'></script>
    <script src='/resource/js/studios/studio.js'></script>
    <script type="text/javascript">
      var socket = io();

      var studioName = String(window.location.pathname.split('/')[2]);
      var signinMail = getCookie('signinMail');
      if (typeof signinMail != 'undefined' || signinMail != '') {
        socket.emit('authorization', signinMail, getDeviceData());
      } else {
        socket.emit('getDataStudio', studioName);
      }

      var dataUser = null;
      socket.on('authorization2', function(user) {
        if (user) {
          dataUser = user;
          socket.emit('getDataStudio', studioName, user);
        } else {
          socket.emit('getDataStudio', studioName);
        }
      });

      var dataStudio = null;
      var dataIsMy = false;
      socket.on('getDataStudio2', function(data, isMy) {
        // isMy = true;

        dataStudio = data;
        dataIsMy = isMy;
        // console.log(data);
        // console.log(isMy);

        if (data) {
          fillStudioPage(data);

          if (isMy) {
            document.getElementById('stringControlStudio').style.display = 'flex';
            document.getElementById('stringCreateGame').style.display = 'flex';
            document.getElementById('stringInviteUser').style.display = 'flex';
            document.getElementById('strokesInfo').style.borderBottom = '1px solid #999';
            document.getElementById('listFolders').style.borderBottom = '1px solid #999';
            document.getElementById('wrapTableStaff').style.borderBottom = '1px solid #999';
            document.getElementById('nogameText').style.borderBottom = '1px solid #999';


            document.getElementById('editDescriptionStudio').style.display = 'flex';
          }

          animationMainBlock();
        } else if (!data) {
          animationNoMainBlock();
        }
      });

      socket.on('getFoldersGames2', function(listAndEmpty) {
        console.log(listAndEmpty);

        document.getElementById('listFolders').style.transform = 'scale(0)';

        setTimeout(function() {
          document.getElementById('listFolders').innerHTML = '';
          document.getElementById('listFolders').style.transform = 'scale(1)';

          for (var i = 0; i < listAndEmpty.length; i++) {
            var files = listAndEmpty[i].files;
            var nameGame = files[0].split('/')[2];

            var wrapFolder = document.createElement('div');
            wrapFolder.setAttribute('class', 'wrapFolder');
            wrapFolder.setAttribute('path', '/g');
            document.getElementById('listFolders').appendChild(wrapFolder);

            // if (typeof list[i] == 'string') {
            //   insertFolder(list[i], false);
            // } else {
            //   insertFolder('/g/'+nameGame, list[i]);
            // }
            insertFolder('/g/'+nameGame, files);

            for (var j = 0; j < listAndEmpty[i].emptyFolders.length; j++) {
              var empty = listAndEmpty[i].emptyFolders[j];
              var partsEmpty = empty.split("/");
              addFolderString('folder', partsEmpty[partsEmpty.length-1], empty);
            }
          }
        }, 200);
      });

      socket.on('getNameHolder2', function(fullName) {
        document.getElementById('linkNameHolder').innerHTML = fullName;
        document.getElementById('linkHolderUser').style.opacity = '1';
      });

      //showBlock(0, document.querySelectorAll('.linkMenu')[0]);
      showBlock(0, document.querySelectorAll('.linkMenu')[0]);

      socket.on('editDescription2', function(text) {
        document.getElementById('strokeDescriptionStudio').innerHTML = text;
      });

      socket.on('getGames2', function(games) {
        for (var i = 0; i < games.length; i++) {
          var oneGame = document.createElement('a');
          oneGame.setAttribute('id', 'oneGame'+i);
          oneGame.setAttribute('class', 'oneGame');
          oneGame.setAttribute('href', '/g/'+games[i].name);
          oneGame.innerHTML = "<div class='rightGame'><div class='titleGame'>"+games[i].name+"</div><div class='authorGame'>"+games[i].authors+"</div></div>";
          document.getElementById('listGames').appendChild(oneGame);
        }
      });

      socket.on('errCreateGmae', function(text) {
        document.getElementById('errorTextCreateGame').innerHTML = text;
        document.getElementById('errorTextCreateGame').style.display = 'flex';
      });

      socket.on('refillPage', function() {
        if (dataUser) {
          socket.emit('getDataStudio', studioName, dataUser);
        } else {
          socket.emit('getDataStudio', studioName);
        }
      });

      socket.on('refreshPage', function() {
        location.reload();
      });

      socket.on('sendtextttt', function(text) {
        console.log(text);
      });

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
    </script>
  </body>
</html>
